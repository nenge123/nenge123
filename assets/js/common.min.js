/**
 * @author Nenge<m@nenge.net>
 * @copyright Nenge.net
 * @license GPL
 * @link https://nenge.net
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t="undefined"!=typeof globalThis?globalThis:t||self)}(this,(function(t){"use strict";const{Array:e,Object:s,String:r,Number:n,Blob:a,File:i,ArrayBuffer:o,Uint8Array:l,Function:c,Boolean:u,Promise:h,FormData:p,URL:d,URLSearchParams:m,TextDecoder:f,TextEncoder:y,document:b,RegExp:g,HTMLElement:w,customElements:S,parseInt:R,Date:A,CustomEvent:C,JSON:F,indexedDB:x,undefined:E,DOMParser:j,prompt:v,alert:k,fetch:M,Response:I,Headers:D,XMLHttpRequest:L,location:T,matchMedia:B,styleMedia:N,Node:O,NodeList:z,StyleSheet:U,console:P,EventTarget:$,Worker:_,Attr:G,Text:J,Document:W,Symbol:H,CSSStyleDeclaration:K,CSSConditionRule:Z,NamedNodeMap:V,Event:q,KeyboardEvent:X,IDBCursorWithValue:Y}=self;class Q{tables=[];Store={};constructor(t,e){e=e||{},s.assign(this,{name:t,config:e})}open(t){const e=this;return rt.Async((s=>{const r=x.open(e.name,e.version);r.once("upgradeneeded",rt.fn(t)?t:t=>{const s=r.result;rt.toArr(e.config,(t=>{const[e,r]=t;if(!s.objectStoreNames.contains(e)){const t=s.createObjectStore(e);rt.toArr(r,(e=>{t.createIndex(e[0],e[0],e[1]||{unique:!1})}))}}))}),r.once("success",(async()=>{const n=r.result;return e.tables=rt.toArr(n.objectStoreNames),e.version=n.version+1,rt.toArr(e.config).filter((t=>!e.tables.includes(t[0])))[0]?(n.close(),s(e.open(t))):(e.Store={},s(n))}))}))}table(t,e){const s=this;return s.Store[t]||(s.config[t]||(s.config[t]=e||{}),s.Store[t]=new tt(t,s)),s.Store[t]}async remove(){const t=this;return t.db&&(await t.db).close(),t.db=E,x.deleteDatabase(t.name)}async delete(t){const e=this;e.db||rt.toArr(await x.databases(),(t=>{e.name===t.name&&(e.version=t.version+1)})),e.db=e.open((s=>{let r=s.target.result;rt.str(t)&&(t=[t]),rt.toArr(t,(t=>{r.objectStoreNames.contains(t)&&r.deleteObjectStore(t),e.config[t]&&(delete e.config[t],delete e.Store[t])}))}))}}class tt{maxsize=104857600;part="-part-";constructor(t,e){rt.defines(this,{table:t,IDB:e},1)}async ObjectStore(t){const e=this.IDB;e.db||(e.db=e.open());return(await(await e.db).transaction([this.table],t?E:"readwrite")).objectStore(this.table)}read(){return this.ObjectStore(!0)}write(){return this.ObjectStore()}async readCall(t,...e){return rt.tryA(await this.read(),t,e)}async writeCall(t,...e){return rt.tryA(await this.write(),t,e)}Result(t,e){return rt.Async((s=>t.on("success",(r=>{const n=t.result;e?e(s,n):s(n)}))))}getItem(t,e){return this.get(t,e)}setItem(t,e){return this.put(e,t)}async clear(){return this.Result(await this.writeCall("clear"))}async count(t){return this.Result(await this.readCall("count",t))}async all(t,e){return this.Result(await this.readCall("getAll",t,e))}async keys(t,e){return this.Result(await this.readCall("getAllKeys",t,e))}async key(t){return this.Result(await this.readCall("getKey",t))}load(t,e){return this.Result(t.get(e))}save(t,e,s){return this.Result(t.put(e,s))}async cursor(t,e){return this.getCursor(await this.readCall("openCursor",t,e))}async keyCursor(t,e){return this.getCursor(await this.readCall("openKeyCursor",t,e))}index(t){return{DB:this,keyPath:t,async read(){const t=await this.DB.read();return t.indexNames.contains(this.keyPath)?t.index(this.keyPath):t},async method(t,...e){return rt.tryA(await this.read(),t,e)},async cursor(t,e){return this.DB.getCursor(await this.method("openCursor",t,e))},async keyCursor(t,e){return this.DB.getCursor(await this.method("openKeyCursor",t,e))},async getItem(t,e,s){return this.DB.get(t,e,await this.read())},async get(t){return this.DB.Result(await this.method("get",t))},async count(t){return this.DB.Result(await this.method("count",t))},async key(t){return this.DB.Result(await this.method("getKey",t))},async keys(t,e){return this.DB.Result(await this.method("getAllKeys",t,e))},async all(t,e){return this.DB.Result(await this.method("getAll",t,e))}}}getCursor(t){const e={};return this.Result(t,((t,s)=>{s?(e[s.primaryKey]=rt.F(s,Y)?s.value:s.key,s.continue()):t(e)}))}async get(t,e,s){const r=this;if(s=s||await r.read(),rt.str(t)){let n=await r.load(s,t);if(!n||e&&n.version&&n.version!=e)return;if(rt.blob(n.contents)||rt.buf(n.contents)){const e=r.maxsize;if(n.filesize>e){let a=n.contents.byteLength||n.contents.size;const o=[n.contents];let l=1;for(;;){let i=n.filesize-a;if(i<=0)break;let c=await r.load(s,t+this.part+l);c&&o.push(c.contents),l+=1,a=i>=e?a+e:n.filesize}n.contents=rt.File(o,n.filename,n.filesize),n.type!=i.name&&(n.contents=await rt.toU8(n.contents))}}return n}if(rt.array(t))return rt.toObj(rt.Async(t.map((async t=>[t,await r.load(s,t)]))))}async put(t,e){const r=await this.write();if(!e){if(rt.str(t))return;if(rt.array(t))return rt.Async(t.map((t=>this.put(t))));if(rt.obj(t)){let s=r.indexNames;if(!t[s])return rt.Async(rt.toArr(t,(t=>this.put(t[1],t[0]))));e=t[s]}}if(rt.blob(t.contents)||rt.buf(t.contents)){const n=t.contents.byteLength||t.contents.size,a=this.maxsize;if(n>a){let i=0,o=0;const l={};for(let e in t)"contents"!==e&&(l[e]=t[e]);for(;;){let c=n-i;if(c<=0)break;let u=c>=a?i+a:n,h=t.contents.slice(i,u),p=0==o?"":this.part+o;await this.save(r,s.assign({contents:h},l),e+p),i=u,o+=1}return}}return this.save(r,t,e)}async putdata(t,e,r,n){const a=s.assign({contents:e,timestamp:new A},n);return r&&(a.version=r),this.put(a,t)}async getdata(t,e){const s=await this.get(t,e);return s&&s.contents||s}async delete(t,e){const s=this,r=await s.write();let n=await s.Result(r.getAllKeys());return rt.Async(n.map((n=>t==n||rt.array(t)&&t.includes(n)||e&&0===n.indexOf(t)?s.Result(r.delete(n)):void 0)))}async fetch(t){let e=(t=at.FetchARG(t)).key;const s=await this.get(e,t.version);if(s&&s.timestamp)return s.type==W.name?at.docElm(s.contents):s.contents;let[n,a]=await at.FetchFile(t);if(n){if(rt.blob(n)){let s=n.size,o=n.type,c=i.name;if(t.unpack){if(n=await at.Decompress(n,((e,s,r)=>{rt.tryC(t,"progress",e,s,r,"unpack")}))||n,t.libjs&&rt.obj(n)){let s;return rt.toArr(n,((r,n)=>{const a=at.LibPad+r[0],o=nt.getMime(r[0]),l=rt.File([r[1]],a,o);this.put({contents:l,filesize:l.size,filename:a,filetype:o,type:i.name,mode:"fetch",timestamp:new A,version:t.version},a),a===e&&(s=l)})),s||n}c=rt.buf(n)?l.name:"unpack"}else t.type&&"blob"==t.type||(n=await at.toFormatBlob(n,t.type,a),c=rt.str(n)?r.name:rt.obj(n)?"json":l.name,"html"==t.type&&(c=W.name));if(this.put({contents:n,filesize:s,filename:e,filetype:o,type:c,mode:"fetch",timestamp:new A,version:t.version},e),"html"==t.type&&rt.str(n))return at.docElm(n)}else"head"==t.type&&this.put(n,e);return n}return null}async ajax(t,e){const s=this;return rt.Async((async n=>{let a=(t=at.FetchARG(t,{async success(o,c){if(!o)return n({});const u={mode:"ajax",timestamp:new A,version:t.version};if(c?(u.headers=c,u.filetype=c.type,rt.F(o,W)?(u.contents=o.documentElement.outerHTML,u.type=W.name):(u.contents=o,u.type=rt.obj(o)?"json":rt.blob(o)?i.name:rt.buf(o)?l.name:r.name)):(u.contents=o,u.type=D.name),await s.put(u,a),e)return n(o);u.type==W.name&&(u.contents=o),n(u)},error(t,e){n({})}})).key||t.href;const o=await s.get(a,t.version);if(o&&o.timestamp)return o.type==W.name&&(o.contents=at.docElm(o.contents)),n(e?o.contents:o);at.ajax(t)}))}}class et{constructor(t,e){this.sheet=t&&t.cssRules?t:b.head.appendChild(b.createElement("style")).sheet,t&&!t.cssRules&&(this.selectorText=e)}selectorText="";insertRule(t,e){if(this.selectorText){const e=this.selectorText;t=(t=["&",":"].includes(t.charAt(0))?"&"==t.charAt(0)?t.replace(/^&/,e):e+t:e+" "+t).replace(/&/g,e)}return rt.tryC(this.sheet,"insertRule",t,rt.num(e)?e:this.ruleLast())}delRule(t){const e=this.ruleItem(t);if(e&&(this.ruleStyle(e).cssText="",e.cssRules))for(;e.cssRules.length;)e.cssRules.deleteRule(0)}addRule(t,e){return rt.num(e)&&this.ruleItem(e)?(this.sheet.deleteRule(e),this.insertRule(t,e)):this.insertRule(t)}ruleItem(t){return rt.num(t)?(t<0&&(t=this.ruleLast()+t+1),this.sheet.cssRules.item(t)||null):null}ruleStyle(t){if(rt.num(t)&&(t=this.ruleItem(t)),t)return t.ownerNode?t.ownerNode.style:t.style}getRule(t){const e=this.ruleItem(t);return e?this.ruleData(e):{}}ruleData(t,e){if(rt.num(t)&&(t=this.ruleItem(t)),t){let s=this.ruleStyle(t),r=rt.toObj(s)||{},n=e&&this.rulesData(t)||[];return n.length&&(r.cssRules=n),r}}rulesData(t){rt.num(t)?t=this.ruleItem(t):rt.nil(t)&&(t=this.sheet);const e=[],s=[];if(t.cssRules)for(let r of t.cssRules)if(rt.F(r,CSSStyleRule))e.push({[r.selectorText]:this.ruleData(r,!0)});else if(rt.F(r,CSSFontFaceRule))s.push({"@font-face":this.ruleData(r)});else if(rt.F(r,Z)){const t=rt.O(r).name.toLowerCase().slice(3,-4);s.push({["@"+t+" "+r.conditionText]:this.rulesData(r)})}else P.log(r);return e.concat(s)}ruleLast(){return this.sheet.cssRules.length}pushCSS(t,e){const s=this.ruleStyle(e);s&&(s.cssText+=t)}setCSS(t,e){const s=this.ruleStyle(e);s&&(s.cssText=t||"")}getCSS(t){const e=this.ruleStyle(t);return e?e.cssText:""}addMedia(t){const e=this.addRule("@media "+t+"{}");return this.NewRule(e)}NewRule(t){const e=this.ruleItem(t);return e?new this.constructor(e,e.selectorText):null}ElmId(t){if(rt.F(this.sheet,CSSStyleRule)||this.selectorText)return this.ElmClass(t);let e=t.getAttribute("id");return e||(e="elm-"+at.getRandStr(),t.setAttribute("id",e)),"#"+e}ElmGetClass(t,e){if(e)for(let e of t.classList)if(/^elm\-\w{23,*}/.test(e))return e;let s="elm-"+at.getRandStr();return t.classList.add(s),s}ElmClass(t){return"."+this.ElmGetClass(t,!0)}Elm2Rule(t,e,s,r){return e=e||"",r=r||"",this.addRule(this.ElmId(t)+r+"{"+e+"}",s)}Elm2Icon(t,e,s,r){if(rt.nil(r))r=this.fontSelete[0];else{if(!0===r)return rt.Mach(this.fontSelete,(r=>this.Elm2Icon(t,e,s,r)))[0];if(rt.array(r))return rt.Mach(r,(r=>this.Elm2Icon(t,e,s,r)))[0]}return s||(s=this.iconFont),this.Elm2Rule(t,`content:"\\${e}";font-family:"${s}";`,!1,r)}Elm2font(t,e,s,r){return isNaN(e)&&!/^&#/.test(e)&&(e=R(e,16)),rt.num(e)&&(e="&#"+e+";"),t.innerHTML=e,this.Elm2Rule(t,`font-family:"${s}";`,!1,r)}fonts=b.fonts;fontList(){return e.from(this.fonts.keys(),(t=>t.family))}fontMime=["woff2","woff","svg","eot","truetype"].filter((t=>CSS.supports("font-format("+t+")")));fontSelete=[":before",":after"];fontCSS="display: inline-block;font-style: normal;font-weight: normal;-webkit-font-smoothing: antialiased;-moz-osx-font-smoothing: grayscale;";iconFont="web-icon";async addFont(t,e,s){e||(e=this.iconFont),rt.str(t)&&(t="url("+t+")");const r=new FontFace(e,t,s||{"font-weight":"normal","font-style":"normal"});this.fonts.add(/blob:/.test(t)?r:await r.load())}addIcon(t,e,s,r){if(r){if(!0===r)return rt.Mach(this.fontSelete,(r=>this.addIcon(t,e,s,r)))[0];if(rt.array(r))return rt.Mach(r,(r=>this.addIcon(t,e,s,r)))[0]}else r=this.fontSelete[0];s||(s=this.iconFont);const n=s+"-"+t;return at.fontsIcon[t]=n,this.addRule(`.${n+r}{${this.fontCSS}font-family:"${s}";content:"${e}"}`),n}getIcon(t){return at.fontsIcon[t]}onMedia(t,e){if(B){let s=B(t);return s.on("change",(t=>e(t.matches,t))),e(s.matches),s}}}class st{constructor(t){const e=navigator.serviceWorker;e?this.ready=rt.Async((s=>{e.on("message",(async e=>{let s=e.data;if(rt.obj(s)){if(rt.fn(t.action[s.clientID]))return t.CF(s.clientID,s);if(rt.fn(t.action[s.method]))return t.CF(s.method,s);P.log(s)}})),e.on("controllerchange",(t=>this.connect(null,t.type))),rt.await(e.ready)&&e.ready.then((t=>{this.connect(t.active,t.type),s(!0)})),this.SW=e})):this.ok=rt.Async(!1)}connect(t,e){at.postMessage({action:e||"connect",DB_NAME:at.DB_NAME,DB_STORE_MAP:at.DB_STORE_MAP,JSpath:at.JSpath,ROOT:at.ROOT},t)}register(t){this.SW.register(t).then((t=>{const e=t.installing||t.active;this.sw=e,this.connect(e,"register"),b.on("visibilitychange",(t=>"visible"===b.visibilityState&&this.connect(null,t.type))),e.on("statechange",(t=>{const e=t.target;["redundant","activated"].includes(e.state)&&(this.connect(e,t.type),at.CF("pwa_"+t.type,t),this.sw=e)})),at.CF("pwa_"+t.type,t)}))}clear(){this.SW.getRegistrations().then((t=>rt.Each(t,(t=>t.unregister()))))}}s.assign($.prototype,{on(t,e,s){return this.addEventListener(t,e,s),this},un(t,e,s){return this.removeEventListener(t,e,s),this},once(t,e,r){return this.on(t,e,s.assign({passive:!1,once:!0},!0===r?{passive:!0}:r||{})),this},toEvent(t,e){return this.dispatchEvent(new C(t,{detail:e})),this}}),s.assign(w.prototype,{AddStyle(t,e){const s=at.css;return rt.num(this.RuleIndex)?e?s.setCSS(t,this.RuleIndex):t&&s.pushCSS(t,this.RuleIndex):this.RuleIndex=s.Elm2Rule(this,t),this.RuleIndex},SetCSS(t){return this.AddStyle(t,!0),this},RuleItem(){return at.css.ruleItem(this.AddStyle())},GetRule(){return at.css.getRule(this.RuleIndex)},GetCSS(){return at.css.getCSS(this.RuleIndex)},NewRule(){return at.css.NewRule(this.AddStyle())},AddMeida(t){return this.NewRule().addMedia(t)},RemoveRule(){return rt.num(this.RuleIndex)&&at.css.delRule(this.RuleIndex),this}});const rt={R:(t,e,s)=>rt.tryC(t,"replace",e,rt.nil(s)?"":s)||"",F:(t,e)=>t instanceof e,C:(t,e)=>!rt.nil(t)&&rt.O(t)===e,O:t=>!rt.nil(t)&&t.constructor,P:t=>t.prototype,I:(t,e)=>e in rt.P(t),Each:(t,e)=>rt.fn(e)?t.forEach(e):t,Mach:(t,s)=>e.from(t,s),elm:t=>rt.F(t,w),await:t=>rt.F(t,h),blob:t=>rt.F(t,a),file:t=>rt.F(t,i),fn:t=>rt.F(t,c),func:t=>rt.fn(t),array:t=>e.isArray(t),obj:t=>rt.C(t,s),buf:t=>rt.C(t&&t.buffer||t,o),u8buf:t=>rt.C(t,l),str:t=>rt.C(t,r),bool:t=>rt.C(t,u),num:t=>rt.C(t,n),null:t=>null===t,none:t=>t===E,nil:t=>rt.null(t)||rt.none(t),toBuf:t=>t.arrayBuffer(),Blob2U8:async t=>rt.toU8(await rt.toBuf(t)),toBlob:t=>rt.blob(t)?t:new a([t.buffer||t]),toU8:t=>rt.u8buf(t)?t:rt.blob(t)?rt.Blob2U8(t):new l(t&&t.buffer||t),toStr:(t,e)=>t.toString(e),toUp:t=>t&&t.toUpperCase(),toLow:t=>t&&t.toLowerCase(),decode:(t,e)=>new f(e).decode(t),encode:t=>(new y).encode(t),toCp437(t){const e="\0☺☻♥♦♣♠•◘○◙♂♀♪♫☼►◄↕‼¶§▬↨↑↓→←∟↔▲▼ !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~⌂ÇüéâäàåçêëèïîìÄÅÉæÆôöòûùÿÖÜ¢£¥₧ƒáíóúñÑªº¿⌐¬½¼¡«»░▒▓│┤╡╢╖╕╣║╗╝╜╛┐└┴┬├─┼╞╟╚╔╩╦╠═╬╧╨╤╥╙╘╒╓╫╪┘┌█▄▌▐▀αßΓπΣσµτΦΘΩδ∞φε∩≡±≥≤⌠⌡÷≈°∙·√ⁿ²■\n";return rt.buf(t)?rt.toArr(t,(t=>e.charAt(t))).join(""):rt.str(t)?rt.toU8(rt.toArr(t,(t=>e.indexOf(t)))):void 0},toInt:(t,e)=>R(t,e),Async:(t,e)=>rt.array(t)?e?h.allSettled(t):h.all(t):rt.fn(t)?new h(t,e):h.resolve(t),getAttr:t=>rt.EachItem(t.attributes||t,!1),setAttr:(t,e)=>(rt.toArr(e,(e=>t.setAttribute(...e))),t),setElm(t,e){let s=rt.O(t);return rt.toArr(e,(e=>{rt.str(e[1])&&!rt.I(s,e[0])?t.setAttribute(...e):rt.fn(e[1])&&rt.I(s,"on"+e[0])?t.once(e[0],e[1]):t[e[0]]=e[1]})),t},tryC:(t,e,...s)=>rt.tryA(t,e,s),tryA(t,e,s,r){if(!rt.nil(t))return e&&rt.str(e)&&(e=t[e]),rt.fn(e)?e.apply(t,s):r?e:E},ForOf(t,e){if(rt.array(t))return rt.Mach(t,e);const r=[];if(!t[H.iterator])return rt.F(t,s)?rt.Mach(s.entries(t),e):r;let n=0;for(const s of t){let a;rt.fn(e)?a=e(s):rt.array(s)?a=s[0]===n?s[1]:s:s&&(a=rt.str(s)&&t.getPropertyValue?[s,t.getPropertyValue(s)]:rt.F(s,G)?[s.name,s.value]:s),n+=1,r.push(a)}return r},EachItem(t,e){const r=rt.ForOf(t);return!1===e?s.fromEntries(r.map(((t,e)=>rt.array(t)&&2==t.length?t:[e,t]))):r},define:(t,e,r,n,a)=>s.defineProperty(t,e,!n||r&&r.value?r:{get:rt.fn(r)?r:()=>r,configurable:1==a}),defines:(t,e,r,n)=>r?rt.toArr(e,(e=>rt.define(t,e[0],e[1],1,n))):s.defineProperties(t,e),empty:t=>!!(rt.nil(t)||rt.str(t)&&!t||rt.array(t)&&!t.length||rt.obj(t)&&!rt.ForOf(t).length),Json:t=>(rt.u8buf(t)&&(t=rt.decode(t)),rt.str(t)?new c("return "+t)():t),toJson:t=>F.stringify(rt.Json(t)),File:(t,e,s)=>new i(t,e,{type:s,lastModified:A.now()}),toPost(t){const e=t instanceof p?t:new p(t instanceof HTMLFormElement?t:E);return rt.obj(t)&&rt.toArr(t,(t=>e.append(t[0],t[1]))),e},toGet(t,...e){let[s,r]=t.split(/\?/);return r=new m(r),rt.Each(e,(t=>{rt.str(t)&&(t=new m(t)),rt.toArr(t,(t=>r.set(t[0],t[1])))})),s+(r.size?"?"+rt.toStr(r):"")},toObj:t=>rt.obj(t)?t:rt.EachItem(t,!1),toArr:(t,e)=>t?(t=rt.array(t)?t:rt.obj(t)?s.entries(t):rt.num(t)||t.byteLength?rt.Mach(rt.toU8(t.buffer||t)):rt.EachItem(t,!0),rt.Mach(t,e)):[]},nt={URL:(t,e)=>rt.str(t)&&t.length<255&&/^(blob|http|\/{1,2}(?!\*)|\.\/|.+\/)[^\n]*?$/i.test(t)?t:(e||(e=rt.blob(t)?t.type:"js"),d.createObjectURL(rt.blob(t)?t:new a([t],{type:nt.getMime(e)}))),reURL:t=>d.revokeObjectURL(t),getPath:t=>t&&t.split("/").slice(0,-1).join("/")+"/",getName(t){if(t){let e=t.split(/\//).pop().split(/\?/)[0].split(/\#/)[0];if(!e){let e=t.match(/([^\?\.\\\/]+\.[a-zA-Z]+)/g);return e?e.pop():""}return e}return""},dirname(t,e){return e||(e=1),this.getPath(t).split("/").slice(0,0-e-1).join("/")+"/"},getExt:t=>rt.toLow(nt.getName(t).split(".").pop()),getKey:t=>rt.R(nt.getName(t),/\.\w+$/),exttype:{},setMime(){nt.extlist=rt.toObj([].concat(..."text;css,scss,sass,xml,vml,style:css,htm:html|php,txt:plain,m3u8:plain,js:javascript\nimage;jpg,jpeg,png,gif,webp,avif,apng,heic,svg:svg+xml\nfont;woff,woff2,ttf,otf\napplication;pdf,json,js:javascript,*:octet-stream,zip:zip|x-zip-compressed,rar:rar|x-rar-compressed,7z:7z|x-7z-compressed,wasm\naudio;ogg,wma,mp3,m4a:mp4\nvideo;mp4".split(/\n/).map((t=>(t=t.split(/;/),[].concat(...t[1].split(/,/).map((e=>{let s=(e=e.split(/:/))[1]&&e[1].split("|")||[e[0]],r=[];for(let n=0;s[n];n++){let a=t[0]+"/"+s[n];nt.exttype[a]=e[0],r.push([e[0],a])}return r}))))))))},getMime:t=>(nt.extlist||nt.setMime(),t=t&&rt.toLow(t)||"",nt.exttype[t]||/^\w+\/[\w\;]+$/.test(t)?t:(/^\w+$/.test(t)||(t=nt.getExt(t)||t.split(".").pop()),nt.extlist[t]||nt.extlist["*"])),Mime(t){let e=this;if(e.extlist||e.setMime(),e.exttype[t])return e.exttype[t];if(t=t&&t.split("/").pop().split(";")[0].split("+")[0].trim())if(!1!==t.indexOf("x-")){if((t=t.match(/x\-(\w+)/))[1])return t[1]}else if(/^\w+$/.test(t))return t;return""},FilterHeader:t=>(rt.toArr(t,(e=>{let s=decodeURI(e[1]);if(rt.num(s)?s=parseFloat(s):/GMT$/.test(s)&&(s=new A(s)),/content-/.test(e[0])){t[e[0]]=s;let r=rt.R(e[0],/content-/);switch(r){case"disposition":let e=s.match(/^attachment;\s*filename=[\"\']+?(.+)[\"\']+?$/i);e&&e[1]&&(t.filename=decodeURI(e[1]));break;case"length":t.filesize=rt.toInt(s)||0;case"password":t[r]=s;break;case"type":s=rt.toLow(s);let n=s.split(/;/);t[r]=n[0].trim(),n[1]&&(t.charset=rt.toLow(n[1].split(/=/).pop().trim()));break}}else t[e[0]]=s})),t),execMime:[["7z",/^377ABCAF271C/],["rar",/^52617221/],["zip",/^504B0304/],["png",/^89504E470D0A1A0A/],["gif",/^47494638(3761|3961)/],["jpg",/^FFD8FFE000104A464946/],["webp",/^52494646\w{8}57454250/],["pdf",/^255044462D312E/],["bmp",/^424D\w{4}0{8}/]],CheckExt(t){if(rt.blob(t)&&t.type){let e=nt.Mime(t.type);if(e)return e}const e=rt.toU8(t.slice(0,16)),s=this.execMime;return rt.await(e)?e.then((t=>nt.execType(t,s))):nt.execType(e,s)},execType(t,e){let s=rt.str(t)?t:rt.toUp(rt.Mach(t,(t=>rt.toStr(t,16).padStart(2,0))).join(""));for(let t=0;t<e.length;t++)if(e[t][1].test(s))return e[t][0]}},at=new class extends ${version=1;DB_NAME="NENGE.NET";DB_STORE_MAP={libjs:{},myfile:{timestamp:!1}};LibStore="libjs";LibPad="script-";language={};StoreList={};libjsBlob={};fontsIcon={};isLocal=/^(127|localhost)/.test(T.host);CLASS={CustomStore:Q,CustomTable:tt,CustomCSS:et};getTable(t,e,s,r){return t?rt.str(t)?(s||(s=at.DB_NAME,r=r||at.DB_STORE_MAP),at.StoreList[s]||(at.StoreList[s]=new EJS_STORAGE_DB(s,r)),at.StoreList[s].table(t,e)):t:null}async FetchCache(t,e,s,r){e=e||"blob";let n=await caches.open(r||at.DB_NAME),a=await n.match(t);if((!a||s&&new A-A.parse(a.headers.get("date"))>s)&&(a=await M(t),a&&n.put(a.url,a.clone())),a)return a[e]()}FetchARG(t,e){return(t=s.assign({url:T.href},rt.str(t)?{url:t}:t,e)).key=!0===t.key?nt.getName(t.url)||"index.html":t.key||t.url,t.libjs&&(/\.zip$/.test(t.key)&&(t.key=t.key.replace(/\.zip$/,".js"),t.unpack=!0),t.key=at.LibPad+nt.getName(t.key),t.version||(t.version=this.version),t.type="blob"),t.headers=s.assign({"ajax-fetch":"ajax"},t.headers||{}),t.json?(t.post=rt.obj(t.json)?rt.toJson(t.json):t.json,t.headers.accept=nt.getMime(rt.obj(post)?"json":"*")):t.post&&(t.post=rt.toPost(t.post)),t.method="head"==t.type?"HEAD":t.post?"POST":"GET",t.href=rt.toGet(t.url,t.get),!/\/\//.test(t.href)||t.href.match(T.host)||t.corss||(t.cross=!1,t.headers=E),t}async FetchFile(t){t&&t.method||(t=this.FetchARG(t));const e=await M(t.href,{method:t.method||"GET",body:t.post||E,headers:t.headers}).catch((e=>{rt.tryC(t,"error",!0,e)}));if(e){const s=nt.FilterHeader(rt.toObj(e.headers)),r=s.filename||nt.getName(t.key),n=s.type;if(200==e.status){const a=e.body.getReader(),i=[],o=s.length;let l=0;for(;;){const{done:e,value:n}=await a.read();if(e)break;i.push(rt.tryC(a,t.reader,n,l,o,s)||n),l+=n.byteLength,rt.tryC(t,"progress",l,o,r,"fetch")}const c=[rt.File(i,r,n),s];return"head"==t.type&&c.shift(),c}{let s;s="json"==n?await e.json():await e.text(),rt.tryC(t,"error",s)}}return[null,null]}async toFormatBlob(t,e,s){return t=await rt.toU8(t),e&&"u8"!=e&&(t=rt.decode(t,s.charset)),"json"==e&&/json$/.test(s.type)&&(t=rt.Json(t)),t}async FetchData(t){t=at.FetchARG(t);let[e,s]=await this.FetchFile(t);return e&&(rt.blob(e)&&(t.unpack?e=await at.Decompress(e,((e,s,r)=>{rt.tryC(t,"progress",e,s,r,"unpack")}),t.password||s.password)||e:t.type&&"blob"==t.type||(e=await at.toFormatBlob(e,t.type,s))),rt.tryC(t,"success",e,s)),e}async FetchLibUrl(t,e,s){return this.libjsBlob[t]||(this.libjsBlob[t]=nt.URL(await at.getTable(at.LibStore).fetch({url:at.libPath+t,libjs:!0,version:s||at.version,progress:e}))),this.libjsBlob[t]}async addLib(t,e,s){nt.getKey(t);this.libjsBlob[t]||await this.addJS(await this.FetchLibUrl(t,e,s),null,/\.css$/.test(t))}ajax(t){const e=new L;return t&&t.method||(t=this.FetchARG(t)),rt.Async((s=>{const r=[];let n=nt.getName(t.url);e.on("readystatechange",(a=>{switch(e.readyState){case e.UNSENT:rt.tryA(e,t.success,r),s(r[0]);break;case e.HEADERS_RECEIVED:const a=rt.tryC(e,e.getAllResponseHeaders),i=nt.FilterHeader(rt.toObj(rt.Mach(a.trim().split(/\n+/),(t=>rt.Mach(t.split(/:\s+/),(t=>rt.R(t.trim(),/^"(.+)"$/,"$1")))))));let o=t.type||i.type.split("/")[1].trim();switch(i.filename&&(n=i.filename),"head"!=o&&t.charset&&(o="buf"),r.push(i),o){case"u8":case"buf":e.responseType="arraybuffer";break;case"html":e.responseType="document";break;case"json":case"xml":e.responseType=o;break;case"file":case"blob":case"javascript":e.responseType="blob";break;case"svg":case"svg+xml":case"js":case"text":e.responseType="text";break;default:e.responseType=/(text|javascript|ini)/.test(i.type)?"text":"blob";break}break;case e.DONE:let l=r[0]&&r[0].type||nt.getMime();if("head"!=t.type){let a=e.response;if(rt.blob(a)&&(a=rt.File([a],n,a.type||l)),rt.buf(a)&&(a=rt.toU8(a),t.charset)){a=rt.decode(a,t.charset);const e=t.type||l.split("/")[1].trim();"blob"==e&&(a=rt.File([a],n,a.type||l)),"buf"!=e&&"u8"!=e||(a=rt.encode(a))}if(r.unshift(a),200!=e.status)return rt.tryA(e,t.error,r),s(null)}rt.tryA(e,t.success,r),s(r[0]);break}})),e.on("progress",(s=>{rt.tryC(e,t.progress,!0,s.loaded,s.total,"")})),e.upload.on("progress",(s=>{rt.tryC(e,t.progress,!1,s.loaded,s.total,"")})),e.open(t.method,!1===t.cross?t.href:rt.toGet(t.url,{inajax:A.now()},t.get)),rt.toArr(t.headers,(t=>{e.setRequestHeader(t[0],t[1])})),e.send(t.post)}))}async ZipWorker(t,e,s){if(!t)return t;let r=this;return await r.getMessage("unpack",t,(function(t,n){return async function(a){if(rt.nil(a.result)){if("progress"==a.state)e&&e(a.current,a.total,a.filename);else if("password"==a.state){let t=s?await s(a.password):v("请输入密码",a.password);a.result=t,r.postMessage(a)}}else n(a.result||null),delete r.action[t]}}))}async ZipCompress(e,s,r,n){rt.nil(t.zip)&&await at.addJS(await at.FetchLibUrl("zip.min.js",s)),rt.bool(r)&&(n=r,r=E);const a=t.zip;if(!0===n){const t=new a.BlobWriter,n=new a.ZipWriter(t);let i;const o=t=>(i||(i=t.name),n.add(t.name,new a.BlobReader(t),{onprogress:(e,r)=>s&&s(e,r,t.name,"pack"),password:r}));return rt.buf(e)&&(e=rt.File([e],"unknow.data",nt.getMime("*"))),rt.blob(e)?await o(e):rt.ForOf(e,(async t=>{rt.array(t)?t=rt.File([t[1]],t[0],nt.getMime(t[0])):rt.buf(t)&&(t=rt.File([t],"unknow.data",nt.getMime("*"))),await o(t)})),await n.close(),rt.File([await t.getData()],i+".zip",nt.getMime("zip"))}{const t="Enter password.",n=await new a.ZipReader(rt.toBlob(e)).getEntries().catch((t=>null));let i;const o=e=>e.getData(new a.Uint8ArrayWriter,{password:e.encrypted&&!1!==r?r:E,onprogress:(t,r)=>s&&s(t,r,e.filename,"unpack")}).catch((async s=>{let n=s.message;if(!1!==r&&(n==a.ERR_INVALID_PASSWORD||n==a.ERR_ENCRYPTED)){if(r=v(t,r))return await o(e);r=!1}}));if(n)for await(let t of n){if(t.directory)continue;let e=await o(t);e&&(i||(i={}),i[t.filename]=e)}return i}}async Decompress(t,e,s){let r=await nt.CheckExt(t);if(/zip$/.test(r))return at.ZipCompress(t,e,s);t=await rt.toU8(t);const n=await at.FetchLibUrl(/7z$/.test(r)?"extract7z.zip":"libunrar.min.zip",e);return n?rt.Async((r=>{let a,i=new _(n);i.on("message",(t=>{if(rt.obj(t.data)){const{t:n,data:o,file:l,total:c,current:u,name:h}=t.data;if(1==n)r(a);else{if(2==n)return!a&&(a={}),o&&(a[l]=o);if(4==n)return c>0&&c>=u&&rt.tryC(e,e,u,c,h||l);if(-1===n){if(s=v(this.pwText,s||""))return i.postMessage({password:s});r(null)}}i.terminate()}})),i.on("error",(t=>{r(null),i.terminate()})),i.onmessageerror=t=>i.toEvent("error"),i.postMessage({contents:t,password:s})})):null}addJS(t,e,s){return rt.Async((r=>{s=s||rt.buf(t)&&(t.type&&/css$/.test(t.type)||t.name&&/css$/.test(t.name));const n=nt.URL(t),a=(s?b.head:b.body).appendChild(b.createElement(s?"link":"script")),i={type:nt.getMime(s?"css":"js"),href:n,src:n,rel:U.name,crossorigin:"anonymous",load(t){this.un("error",i.error),r(e&&e(t)||t)},error(t){this.un("load",i.error),r(e&&e(t)||t)}};rt.setElm(a,i)}))}customElement(t,e){if(!S.get(t)){const r=class extends w{constructor(){super();const t=this.dataset.callinit;this.tag_name=this.tagName.toLowerCase(),this.goFunc(t||"Init")}goFunc(t,...e){if(this[t])return this[t](...e);const s=this.tag_name.replace(/\-(\w)/,(t=>t[1].toUpperCase()));P.log(s+t),rt.tryA(this,at.action[s+t],e)}connectedCallback(...t){const e=this.dataset.callback;this.goFunc(e||"Connected",...t)}attributeChangedCallback(...t){const e=this.dataset.callattr;this.goFunc(e||"AttrChange",...t)}disconnectedCallback(...t){const e=this.dataset.callremove;this.goFunc(e||"Disconnected",...t)}};e&&s.assign(r.prototype,e),S.define(t,r)}}Err(t){return new Error(t)}async download(t,e,s){let r;return!e&&t&&(e=t,t=null),/^(http|blob:|data:)/.test(e)?(r=e,!t&&/^(http|blob:)/.test(e)&&(t=nt.getName(e))):e&&(rt.file(e)&&(t=e.name),r=nt.URL(e,s)),t||(t="explame.html"),rt.Async((e=>{const s=b.createElement("a");s.href=r,s.download=t,s.click(),s.remove(),e(!0)}))}toSet(t){(t=t||new class extends ${}).action=t.action||{};const{RF:e,CF:r,BF:n}=this;return s.assign(t,{RF:e,CF:r,BF:n}),t}$(t,e){return t?rt.str(t)?(e||b).querySelector(t):rt.fn(t)?at.docload(t):t:E}$$(t,e){return(e||b).querySelectorAll(t)||[]}docElm(t,e){return(new j).parseFromString(t,e||b.contentType).documentElement}RF(t,e){return rt.tryA(this,this.action[t],e,!0)}CF(t,...e){return this.RF(t,e)}BF(t,e,...s){const r=this.action[t];return rt.fn(r)?rt.tryA(e,r,s):E}GL(t,e){return rt.none(at.language[t])||(t=at.language[t]),e?at.toReplace(t,e):t}toReplace(t,e){return rt.str(e)?t=rt.R(t,/{value}/,e):rt.obj(e)&&rt.toArr(e,(e=>rt.R(t,new g(e[0],"g"),e[1]))),t}async toZip(t,e,s){return at.ZipCompress(t,e,s,!0)}upload(t,e,s){const r=b.createElement("input");rt.setElm(r,{type:i.name,accept:e,multiple:s,change(){this.remove(),rt.tryC(this,t,rt.toArr(this.files))},cancel(){this.remove()}}).click()}async postMessage(t,e){e||(e=navigator.serviceWorker.ready,rt.await(e)?e=(await e).active:this.SW.sw&&(e=this.SW.sw)),e&&e.postMessage(t)}getRandStr(){return btoa(rt.tryC(crypto,"randomUUID")||performance.now()+Math.random()).replace(/[^\w]/g,"")}getMessage(t,e,s){let r=this;return rt.Async((n=>{let a=r.getRandStr();r.action[a]=rt.fn(s)?s(a,n):function(t){n(t.result),r.action[a]=null,delete r.action[a]},r.postMessage({clientID:a,method:t,result:e})}))}async getTemplate(t,e){let s=await this.getTable("libjs").ajax({url:"/template-"+t+".html",type:"text"});return rt.toArr(e,(t=>{s=s.replace(new g(t[0],"g"),t[1])})),s=s.replace(/\{[\w\-\_]+?\}/,""),s}action={};docload(t){if("complete"==b.readyState)rt.tryC(this,t);else{const e=s=>{"complete"==b.readyState&&(rt.tryC(this,t),b.un("readystatechange",e))};b.on("readystatechange",e)}}constructor(){super();const t=this;let{language:e,onLine:r}=navigator,{readyState:n,currentScript:a,characterSet:i}=b,o=a&&a.src.split(/\?/),l=o&&nt.getPath(o[0]),c=rt.toLow(e).split("-");"zh"==c[0]&&("cn"==c[1]?c[1]="hans":"hk"!=c[1]&&(c[1]="hant")),s.assign(t,{I:rt,F:nt,JSpath:l,libPath:l+"lib/",ROOT:nt.dirname(l,2),i18nName:c.join("-"),langName:e,onLine:r,readyState:n,isTouch:rt.I(w,"ontouchstart"),css:new et,SW:new st(t)}),a&&(t.debug=!!a.getAttribute("data-debug"),t.docload((async e=>{const s=t.getTable("libjs"),r=nt.dirname(t.JSpath),{router:n,fonts:i,version:o}=a.dataset;t.hashVersion=o?R(o):t.version,i&&await rt.Async(i.trim().split(",").map((e=>s.fetch({url:r+e.split(":")[1],key:!0}).then((s=>t.css.addFont(s,e.split(":")[0])))))),n&&await rt.Async(n.trim().split(",").map((e=>e&&t.addJS(t.JSpath+"router/"+e+".js?"+t.hashVersion)))),P.log(n),t.toEvent("ready")})))}};window.onerror=t=>k(t),s.assign(t,{T:at,F:nt,I:rt}),rt.defines(t,{Nenge:at},1)}));