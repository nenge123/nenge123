/**
 * @author Nenge<m@nenge.net>
 * @copyright Nenge.net
 * @license GPL
 * @link https://nenge.net
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t="undefined"!=typeof globalThis?globalThis:t||self)}(this,(function(t){"use strict";const{Array:e,Object:s,String:n,Number:r,Blob:i,File:a,ArrayBuffer:o,Uint8Array:l,Function:c,Boolean:u,Promise:h,FormData:d,URL:p,URLSearchParams:f,TextDecoder:m,TextEncoder:y,document:g,RegExp:b,HTMLElement:w,customElements:S,parseInt:v,Date:C,CustomEvent:R,JSON:k,indexedDB:A,undefined:x,DOMParser:E,prompt:F,alert:j,fetch:M,Response:I,Headers:L,XMLHttpRequest:D,location:T,matchMedia:N,styleMedia:B,Node:U,NodeList:$,StyleSheet:O,console:W,EventTarget:z,Worker:_,Attr:P,Text:G,Document:H,Symbol:J,CSSStyleDeclaration:K,CSSConditionRule:q,NamedNodeMap:V,Event:Z,KeyboardEvent:X,IDBCursorWithValue:Y,Notification:Q}=self;class tt{tables=[];Store={};constructor(t,e){e=e||{},s.assign(this,{name:t,config:e})}open(t){const e=this;return rt.Async((s=>{const n=A.open(e.name,e.version);n.once("upgradeneeded",rt.fn(t)?t:t=>{const s=n.result;rt.toArr(e.config,(t=>{const[e,n]=t;if(!s.objectStoreNames.contains(e)){const t=s.createObjectStore(e);rt.toArr(n,(e=>{t.createIndex(e[0],e[0],e[1]||{unique:!1})}))}}))}),n.once("success",(async()=>{const r=n.result;return e.tables=rt.toArr(r.objectStoreNames),e.version=r.version+1,rt.toArr(e.config).filter((t=>!e.tables.includes(t[0])))[0]?(r.close(),s(e.open(t))):(e.Store={},s(r))}))}))}table(t,e){const s=this;return s.Store[t]||(s.config[t]||(s.config[t]=e||{}),s.Store[t]=new et(t,s)),s.Store[t]}async remove(){const t=this;return t.db&&(await t.db).close(),t.db=x,A.deleteDatabase(t.name)}async delete(t){const e=this;e.db||rt.toArr(await A.databases(),(t=>{e.name===t.name&&(e.version=t.version+1)})),e.db=e.open((s=>{let n=s.target.result;rt.str(t)&&(t=[t]),rt.toArr(t,(t=>{n.objectStoreNames.contains(t)&&n.deleteObjectStore(t),e.config[t]&&(delete e.config[t],delete e.Store[t])}))}))}}class et{maxsize=104857600;part="-part-";constructor(t,e){rt.defines(this,{table:t,IDB:e},1)}async ObjectStore(t){const e=this.IDB;e.db||(e.db=e.open());return(await(await e.db).transaction([this.table],t?x:"readwrite")).objectStore(this.table)}read(){return this.ObjectStore(!0)}write(){return this.ObjectStore()}async readCall(t,...e){return rt.tryA(await this.read(),t,e)}async writeCall(t,...e){return rt.tryA(await this.write(),t,e)}Result(t,e){return rt.Async((s=>t.on("success",(n=>{const r=t.result;e?e(s,r):s(r)}))))}getItem(t,e){return this.get(t,e)}setItem(t,e){return this.put(e,t)}async clear(){return this.Result(await this.writeCall("clear"))}async count(t){return this.Result(await this.readCall("count",t))}async all(t,e){return this.Result(await this.readCall("getAll",t,e))}async keys(t,e){return this.Result(await this.readCall("getAllKeys",t,e))}async key(t){return this.Result(await this.readCall("getKey",t))}load(t,e){return this.Result(t.get(e))}save(t,e,s){return this.Result(t.put(e,s))}async cursor(t,e){return this.getCursor(await this.readCall("openCursor",t,e))}async keyCursor(t,e){return this.getCursor(await this.readCall("openKeyCursor",t,e))}index(t){return{DB:this,keyPath:t,async read(){const t=await this.DB.read();return t.indexNames.contains(this.keyPath)?t.index(this.keyPath):t},async method(t,...e){return rt.tryA(await this.read(),t,e)},async cursor(t,e){return this.DB.getCursor(await this.method("openCursor",t,e))},async keyCursor(t,e){return this.DB.getCursor(await this.method("openKeyCursor",t,e))},async getItem(t,e,s){return this.DB.get(t,e,await this.read())},async get(t){return this.DB.Result(await this.method("get",t))},async count(t){return this.DB.Result(await this.method("count",t))},async key(t){return this.DB.Result(await this.method("getKey",t))},async keys(t,e){return this.DB.Result(await this.method("getAllKeys",t,e))},async all(t,e){return this.DB.Result(await this.method("getAll",t,e))}}}getCursor(t){const e={};return this.Result(t,((t,s)=>{s?(e[s.primaryKey]=rt.F(s,Y)?s.value:s.key,s.continue()):t(e)}))}async get(t,e,s){const n=this;if(s=s||await n.read(),rt.str(t)){let r=await n.load(s,t);if(!r||e&&r.version&&r.version!=e)return;if(rt.blob(r.contents)||rt.buf(r.contents)){const e=n.maxsize;if(r.filesize>e){let i=r.contents.byteLength||r.contents.size;const o=[r.contents];let l=1;for(;;){let a=r.filesize-i;if(a<=0)break;let c=await n.load(s,t+this.part+l);c&&o.push(c.contents),l+=1,i=a>=e?i+e:r.filesize}r.contents=rt.File(o,r.filename,r.filesize),r.type!=a.name&&(r.contents=await rt.toU8(r.contents))}}return r}if(rt.array(t))return rt.toObj(rt.Async(t.map((async t=>[t,await n.load(s,t)]))))}async put(t,e){const n=await this.write();if(!e){if(rt.str(t))return;if(rt.array(t))return rt.Async(t.map((t=>this.put(t))));if(rt.obj(t)){let s=n.indexNames;if(!t[s])return rt.Async(rt.toArr(t,(t=>this.put(t[1],t[0]))));e=t[s]}}if(rt.blob(t.contents)||rt.buf(t.contents)){const r=t.contents.byteLength||t.contents.size,i=this.maxsize;if(r>i){let a=0,o=0;const l={};for(let e in t)"contents"!==e&&(l[e]=t[e]);for(;;){let c=r-a;if(c<=0)break;let u=c>=i?a+i:r,h=t.contents.slice(a,u),d=0==o?"":this.part+o;await this.save(n,s.assign({contents:h},l),e+d),a=u,o+=1}return}}return this.save(n,t,e)}async putdata(t,e,n,r){const i=s.assign({contents:e,timestamp:new C},r);return n&&(i.version=n),this.put(i,t)}async getdata(t,e){const s=await this.get(t,e);return s&&s.contents||s}async delete(t,e){const s=this,n=await s.write();let r=await s.Result(n.getAllKeys());return rt.Async(r.map((r=>t==r||rt.array(t)&&t.includes(r)||e&&0===r.indexOf(t)?s.Result(n.delete(r)):void 0)))}async fetch(t){let e=(t=it.FetchARG(t)).key,r=await this.get(e,t.version);if(r&&r.timestamp){if(it.onLine&&t.modified&&r.modified){let e=await it.FetchData({url:t.href,type:"head"});e&&e["last-modified"]!=r.modified&&(r=null)}if(null!=r)return r.type==H.name?it.docElm(r.contents):r.contents}let[i,o]=await it.FetchFile(t);if(i){if(rt.blob(i)){const r={filesize:i.size,filetype:i.type,filename:e,type:a.name,mode:"fetch",timestamp:new C};let c;if(t.options&&s.assign(r,t.options),t.version&&(r.version=t.version),o&&o["last-modified"]&&(r.modified=o["last-modified"]),t.unpack){if(i=await it.Decompress(i,((e,s,n)=>{rt.tryC(t,"progress",e,s,n,"unpack")}))||i,t.libjs&&rt.obj(i)){let n;return rt.toArr(i,((i,a)=>{const o=t.libjs+i[0],l=it.getMime(i[0]),c=rt.File([i[1]],o,l);this.put(s.assign({contents:c},r,{filename:o,filesize:c.size}),o),o===e&&(n=c)})),n||i}c=rt.buf(i)?l.name:"unpack"}else t.type&&"blob"==t.type||(i=await it.toFormatBlob(i,t.type,o),c=rt.str(i)?n.name:rt.obj(i)?"json":l.name,"html"==t.type&&(c=H.name));if(c&&(r.type=c),this.put(s.assign({contents:i},r),e),"html"==t.type&&rt.str(i))return it.docElm(i)}else"head"==t.type&&this.put({contents:i,modified:i["last-modified"],timestamp:new C},e);return i}return null}async ajax(t,e){const s=this;return rt.Async((async r=>{let i=(t=it.FetchARG(t,{async success(o,c){if(!o)return r({});const u={mode:"ajax",timestamp:new C};let h;if(c?(u.headers=c,u.filetype=c.type,u.modified=c["last-modified"],rt.F(o,H)?(u.contents=o.documentElement.outerHTML,h=H.name):(u.contents=o,h=rt.obj(o)?"json":rt.blob(o)?a.name:rt.buf(o)?l.name:n.name)):(u.contents=o,h=L.name),h&&(u.type=h),t.version&&(u.version=t.version),await s.put(u,i),e)return r(o);u.type==H.name&&(u.contents=o),r(u)},error(t,e){r({})}})).key||t.href;const o=await s.get(i,t.version);if(o&&o.timestamp)return o.type==H.name&&(o.contents=it.docElm(o.contents)),r(e?o.contents:o);it.ajax(t)}))}}class st{constructor(t,e){this.sheet=t&&t.cssRules?t:g.head.appendChild(g.createElement("style")).sheet,t&&!t.cssRules&&(this.selectorText=e)}selectorText="";insertRule(t,e){if(this.selectorText){const e=this.selectorText;t=(t=["&",":"].includes(t.charAt(0))?"&"==t.charAt(0)?t.replace(/^&/,e):e+t:e+" "+t).replace(/&/g,e)}return rt.tryC(this.sheet,"insertRule",t,rt.num(e)?e:this.ruleLast())}delRule(t){const e=this.ruleItem(t);if(e&&(this.ruleStyle(e).cssText="",e.cssRules))for(;e.cssRules.length;)e.cssRules.deleteRule(0)}addRule(t,e){return rt.num(e)&&this.ruleItem(e)?(this.sheet.deleteRule(e),this.insertRule(t,e)):this.insertRule(t)}ruleItem(t){return rt.num(t)?(t<0&&(t=this.ruleLast()+t+1),this.sheet.cssRules.item(t)||null):null}ruleStyle(t){if(rt.num(t)&&(t=this.ruleItem(t)),t)return t.ownerNode?t.ownerNode.style:t.style}getRule(t){const e=this.ruleItem(t);return e?this.ruleData(e):{}}ruleData(t,e){if(rt.num(t)&&(t=this.ruleItem(t)),t){let s=this.ruleStyle(t),n=rt.toObj(s)||{},r=e&&this.rulesData(t)||[];return r.length&&(n.cssRules=r),n}}rulesData(t){rt.num(t)?t=this.ruleItem(t):rt.nil(t)&&(t=this.sheet);const e=[],s=[];if(t.cssRules)for(let n of t.cssRules)if(rt.F(n,CSSStyleRule))e.push({[n.selectorText]:this.ruleData(n,!0)});else if(rt.F(n,CSSFontFaceRule))s.push({"@font-face":this.ruleData(n)});else if(rt.F(n,q)){const t=rt.O(n).name.toLowerCase().slice(3,-4);s.push({["@"+t+" "+n.conditionText]:this.rulesData(n)})}else W.log(n);return e.concat(s)}ruleLast(){return this.sheet.cssRules.length}pushCSS(t,e){const s=this.ruleStyle(e);s&&(s.cssText+=t)}setCSS(t,e){const s=this.ruleStyle(e);s&&(s.cssText=t||"")}getCSS(t){const e=this.ruleStyle(t);return e?e.cssText:""}addMedia(t){const e=this.addRule("@media "+t+"{}");return this.NewRule(e)}NewRule(t){const e=this.ruleItem(t);return e?new this.constructor(e,e.selectorText):null}ElmId(t){if(rt.F(this.sheet,CSSStyleRule)||this.selectorText)return this.ElmClass(t);let e=t.getAttribute("id");return e||(e="elm-"+it.getRandStr(),t.setAttribute("id",e)),"#"+e}ElmGetClass(t,e){if(e)for(let e of t.classList)if(/^elm\-\w{23,*}/.test(e))return e;let s="elm-"+it.getRandStr();return rt.addClass(t,s),s}ElmClass(t){return"."+this.ElmGetClass(t,!0)}Elm2Rule(t,e,s,n){return e=e||"",n=n||"",this.addRule(this.ElmId(t)+n+"{"+e+"}",s)}Elm2Icon(t,e,s,n){if(rt.nil(n))n=this.fontSelete[0];else{if(!0===n)return rt.Mach(this.fontSelete,(n=>this.Elm2Icon(t,e,s,n)))[0];if(rt.array(n))return rt.Mach(n,(n=>this.Elm2Icon(t,e,s,n)))[0]}return s||(s=this.iconFont),this.Elm2Rule(t,`content:"\\${e}";font-family:"${s}";`,!1,n)}Elm2font(t,e,s,n){return isNaN(e)&&!/^&#/.test(e)&&(e=v(e,16)),rt.num(e)&&(e="&#"+e+";"),t.innerHTML=e,this.Elm2Rule(t,`font-family:"${s}";`,!1,n)}fonts=g.fonts;fontList(){return e.from(this.fonts.keys(),(t=>t.family))}fontMime=["woff2","woff","svg","eot","truetype"].filter((t=>CSS.supports("font-format("+t+")")));fontSelete=[":before",":after"];fontCSS="display: inline-block;font-style: normal;font-weight: normal;-webkit-font-smoothing: antialiased;-moz-osx-font-smoothing: grayscale;";iconFont="web-icon";async addFont(t,e,s){e||(e=this.iconFont),rt.str(t)&&(t="url("+t+")");const n=new FontFace(e,t,s||{"font-weight":"normal","font-style":"normal"});this.fonts.add(/blob:/.test(t)?n:await n.load())}addIcon(t,e,s,n){if(n){if(!0===n)return rt.Mach(this.fontSelete,(n=>this.addIcon(t,e,s,n)))[0];if(rt.array(n))return rt.Mach(n,(n=>this.addIcon(t,e,s,n)))[0]}else n=this.fontSelete[0];s||(s=this.iconFont);const r=s+"-"+t;return it.fontsIcon[t]=r,this.addRule(`.${r+n}{${this.fontCSS}font-family:"${s}";content:"${e}"}`),r}getIcon(t){return it.fontsIcon[t]}onMedia(t,e){if(N){let s=N(t);return s.on("change",(t=>e(t.matches,t))),e(s.matches),s}}}class nt{constructor(t,e){let s=navigator.serviceWorker;s?(s.register(e).then((e=>{e.installing&&this.connect(e.installing,"register");(e.installing||e.active).on("statechange",(t=>{const e=t.target;["redundant","activated"].includes(e.state)&&this.connect(e,"register")})),t.CF("pwa_loader")})),this.ready=(async()=>{let t=navigator.serviceWorker;return!!rt.await(t.ready)&&(t.on("message",this._message),t.on("controllerchange",(t=>this.connect(t.active,"register"))),await t.ready,!0)})(),Q&&"granted"!=Q.permission&&rt.tryC(Q,"requestPermission")):this.ok=rt.Async(!1)}async _message(t){let e=t.data,s=t.source;if(it.isLocal&&W.log(e),rt.obj(e)){let t=e.clientID,n=e.method;t&&rt.fn(it.action[t])?await it.action[t](e,s):n&&rt.fn(it.action[n])&&await it.action[n](e,s),t=null,n=null,e=null}}async connect(t,e){(t=t||(await navigator.serviceWorker.ready).active).postMessage({method:e||"connect"})}async clear(){let t=await navigator.serviceWorker.getRegistrations();rt.Each(t,(t=>t.unregister()))}async permission(t){let e=await navigator.permissions.query({name:t}).catch((t=>null));return!(!e||"granted"!=e.state)}async notice(t,e){await this.permission("notifications")&&(await navigator.serviceWorker.ready).showNotification(t,e)}async sync(t){if(!await this.permission("background-sync"))return this.postSync(t);(await navigator.serviceWorker.ready).sync.register(t)}async postSync(t){return it.postMessage({method:"sync",tag:t})}async periodicSync(t,e,s){await this.permission("periodic-background-sync")&&(await navigator.serviceWorker.ready).periodicSync.register(t,e)}async setPush(t){if(!await this.permission("push"))return;let e=await navigator.serviceWorker.ready,s=await e.pushManager.permissionState({userVisibleOnly:!0,applicationServerKey:t});if(W.log(s),"granted"==s){let s=await e.pushManager.getSubscription();s||(s=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:t})),W.log(s)}}}const rt={R:(t,e,s)=>rt.tryC(t,"replace",e,rt.nil(s)?"":s)||"",F:(t,e)=>t instanceof e,C:(t,e)=>!rt.nil(t)&&rt.O(t)===e,O:t=>!rt.nil(t)&&t.constructor,P:t=>t.prototype,I:(t,e)=>e in rt.P(t),Each:(t,e)=>rt.fn(e)?t.forEach(e):t,Mach:(t,s)=>e.from(t,s),elm:t=>rt.F(t,w),await:t=>rt.F(t,h),blob:t=>rt.F(t,i),file:t=>rt.F(t,a),fn:t=>rt.F(t,c),func:t=>rt.fn(t),array:t=>e.isArray(t),obj:t=>rt.C(t,s),buf:t=>rt.C(t&&t.buffer||t,o),u8buf:t=>rt.C(t,l),str:t=>rt.C(t,n),bool:t=>rt.C(t,u),num:t=>rt.C(t,r),int:t=>!rt.null(t)&&!isNaN(t),null:t=>null===t,none:t=>t===x,nil:t=>rt.null(t)||rt.none(t),toBuf:t=>t.arrayBuffer(),Blob2U8:async t=>rt.toU8(await rt.toBuf(t)),toBlob:t=>rt.blob(t)?t:new i([t.buffer||t]),toU8:t=>rt.u8buf(t)?t:rt.blob(t)?rt.Blob2U8(t):new l(t&&t.buffer||t),toStr:(t,e)=>rt.array(t)?t.join(e||""):t?t.toString(e):"",buf2str:t=>rt.toArr(t,(t=>rt.toStr(t,16).padStart(2,"0"))),toUp:t=>rt.array(t)?rt.toUp(rt.toStr(t)):t&&t.toUpperCase(),toLow:t=>rt.array(t)?rt.toLow(rt.toStr(t)):t&&t.toLowerCase(),decode:(t,e)=>new m(e).decode(t),encode:t=>(new y).encode(t),toCp437(t){const e="\0☺☻♥♦♣♠•◘○◙♂♀♪♫☼►◄↕‼¶§▬↨↑↓→←∟↔▲▼ !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~⌂ÇüéâäàåçêëèïîìÄÅÉæÆôöòûùÿÖÜ¢£¥₧ƒáíóúñÑªº¿⌐¬½¼¡«»░▒▓│┤╡╢╖╕╣║╗╝╜╛┐└┴┬├─┼╞╟╚╔╩╦╠═╬╧╨╤╥╙╘╒╓╫╪┘┌█▄▌▐▀αßΓπΣσµτΦΘΩδ∞φε∩≡±≥≤⌠⌡÷≈°∙·√ⁿ²■\n";return rt.buf(t)?rt.toStr(rt.toArr(t,(t=>e.charAt(t)))):rt.str(t)?rt.toU8(rt.toArr(t,(t=>e.indexOf(t)))):void 0},toInt:(t,e)=>v(t,e),Async:(t,e)=>rt.array(t)?e?h.allSettled(t):h.all(t):rt.fn(t)?new h(t,e):h.resolve(t),getAttr:t=>rt.EachItem(t.attributes||t,!1),setAttr:(t,e)=>(rt.toArr(e,(e=>t.setAttribute(...e))),t),setStyle(t,e,s){if(rt.obj(e))return rt.toArr(e,(e=>rt.setStyle(t,...e)));rt.tryC(t&&t.style||t,"setProperty",e,s)},addClass(t,...e){rt.tryA(t&&t.classList,"add",e)},removeClass(t,...e){rt.tryA(t&&t.classList,"remove",e)},setElm(t,e){let s=rt.O(t);return rt.toArr(e,(e=>{rt.str(e[1])&&!rt.I(s,e[0])?t.setAttribute(...e):rt.fn(e[1])&&rt.I(s,"on"+e[0])?t.once(e[0],e[1]):t[e[0]]=e[1]})),t},tryC:(t,e,...s)=>rt.tryA(t,e,s),tryA(t,e,s,n){if(!rt.nil(t))return e&&rt.str(e)&&(e=t[e]),rt.fn(e)?e.apply(t,s):n?e:x},ForOf(t,e){if(rt.array(t))return rt.Mach(t,e);const n=[];if(!t[J.iterator])return rt.F(t,s)?rt.Mach(s.entries(t),e):n;let r=0;for(const s of t){let i;rt.fn(e)?i=e(s):rt.array(s)?i=s[0]===r?s[1]:s:s&&(i=rt.str(s)&&t.getPropertyValue?[s,t.getPropertyValue(s)]:rt.F(s,P)?[s.name,s.value]:s),r+=1,n.push(i)}return n},EachItem(t,e){const n=rt.ForOf(t);return!1===e?s.fromEntries(n.map(((t,e)=>rt.array(t)&&2==t.length?t:[e,t]))):n},define:(t,e,n,r,i)=>s.defineProperty(t,e,!r||n&&n.value?n:{get:rt.fn(n)?n:()=>n,configurable:1==i}),defines:(t,e,n,r)=>n?rt.toArr(e,(e=>rt.define(t,e[0],e[1],1,r))):s.defineProperties(t,e),empty:t=>!!(rt.nil(t)||rt.str(t)&&!t||rt.array(t)&&!t.length||rt.obj(t)&&!rt.ForOf(t).length),Json:t=>(rt.u8buf(t)&&(t=rt.decode(t)),rt.str(t)?new c("return "+t)():t),toJson:t=>k.stringify(rt.Json(t)),File:(t,e,s)=>new a(t,e,{type:s,lastModified:C.now()}),toPost(t){const e=t instanceof d?t:new d(t instanceof HTMLFormElement?t:x);return rt.obj(t)&&rt.toArr(t,(t=>e.append(t[0],t[1]))),e},toGet(t,...e){let[s,n]=t.split(/\?/);return n=new f(n),rt.Each(e,(t=>{rt.str(t)&&(t=new f(t)),rt.toArr(t,(t=>n.set(t[0],t[1])))})),s+(n.size?"?"+rt.toStr(n):"")},toObj:t=>rt.obj(t)?t:rt.EachItem(t,!1),toArr:(t,e)=>t?(t=rt.array(t)?t:rt.obj(t)?s.entries(t):rt.num(t)||t.byteLength?rt.Mach(rt.toU8(t.buffer||t)):rt.EachItem(t,!0),rt.Mach(t,e)):[],GbByte(){let t=[[161,169,161,254],[176,247,161,254],[129,160,64,254],[170,254,64,160],[168,169,64,160],[170,175,161,254],[248,254,161,254],[161,167,64,160]],e=new Uint16Array(23940),s=0;for(let[n,r,i,a]of t)for(let t=i;t<=a;t++)if(127!==t)for(let i=n;i<=r;i++)e[s++]=t<<8|i;let n=new Uint16Array(65536),r=new m("gbk").decode(e.buffer);for(let t=0;t<r.length;t++)n[r.codePointAt(t)]=e[t];return r=null,e=null,n},toGB2312(t){this.gb2312||(this.gb2312=this.GbByte());let e=[];for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);if(n<128){e.push(n);continue}const r=this.gb2312.at(n);r?e.push(r,r>>8):8364===n?e.push(128):e.push(63)}return new l(e)}},it=new class extends z{version=2;DB_NAME="NENGE.NET";DB_STORE_MAP={libjs:{},myfile:{timestamp:!1}};LibStore="libjs";language={};StoreList={};libjsBlob={};fontsIcon={};isLocal=/^(127|localhost)/.test(T.host);CLASS={CustomStore:tt,CustomTable:et,CustomCSS:st};getTable(t,e,s,n){return t?rt.str(t)?(s||(s=it.DB_NAME,n=n||it.DB_STORE_MAP),it.StoreList[s]||(it.StoreList[s]=new tt(s,n)),it.StoreList[s].table(t,e)):t:null}FetchARG(t,e){return(t=s.assign({url:T.href},rt.str(t)?{url:t}:t,e)).key=!0===t.key?this.getName(t.url)||"index.html":t.key||t.url,t.libjs&&(/\.zip$/.test(t.key)&&(t.key=t.key.replace(/\.zip$/,".js"),t.unpack=!0),t.key=t.libjs+this.getName(t.key),t.version||(t.version=this.version),t.type="blob"),t.headers=s.assign({"ajax-fetch":"ajax"},t.headers||{}),t.json?(t.post=rt.obj(t.json)?rt.toJson(t.json):t.json,t.headers.accept=it.getMime(rt.obj(post)?"json":"*"),delete t.json):t.post&&(t.post=rt.toPost(t.post)),"head"!=t.method&&t.post?t.method="post":t.method=t.method||"get",t.href=rt.toGet(t.url,t.params),/^http/.test(t.href)&&!t.corss&&-1===t.href.indexOf(T.origin)&&(t.cross=!1,t.headers=x),t}async FetchFile(t){t&&t.method||(t=this.FetchARG(t));const e=await M(t.href,{method:rt.toUp(t.method),body:t.post||x,headers:t.headers}).catch((e=>{rt.tryC(t,"error",!0,e)}));if(e){const s=this.FilterHeader(rt.toObj(e.headers)),n=s.filename||this.getName(t.key),r=s.type;if(200==e.status){if("head"==t.type)return[s];{const i=e.body.getReader(),a=[],o=s.length;let l=0;for(;;){const{done:e,value:r}=await i.read();if(e)break;a.push(rt.tryC(i,t.reader,r,l,o,s)||r),l+=r.byteLength,rt.tryC(t,"progress",l,o,n,"fetch")}return[rt.File(a,n,r),s]}}{let s;s="json"==r?await e.json():await e.text(),rt.tryC(t,"error",s)}}return[null,null]}async toFormatBlob(t,e,s){return t=await rt.toU8(t),e&&"u8"!=e&&(t=rt.decode(t,s.charset)),"json"==e&&/json$/.test(s.type)&&(t=rt.Json(t)),t}async FetchData(t){t&&t.method||(t=this.FetchARG(t));let[e,s]=await this.FetchFile(t);return e&&(rt.blob(e)&&(t.unpack?e=await it.Decompress(e,((e,s,n)=>{rt.tryC(t,"progress",e,s,n,"unpack")}),t.password||s.password)||e:t.type&&"blob"==t.type||(e=await it.toFormatBlob(e,t.type,s))),rt.tryC(t,"success",e,s)),e}FilterHeader(t){return rt.toArr(t,(e=>{let s=decodeURI(e[1]);if(rt.num(s)?s=parseFloat(s):/GMT$/.test(s)&&(s=new C(s)),/content-/.test(e[0])){t[e[0]]=s;let n=rt.R(e[0],/content-/);switch(n){case"disposition":let e=s.match(/^attachment;\s*filename=[\"\']+?(.+)[\"\']+?$/i);e&&e[1]&&(t.filename=decodeURI(e[1]));break;case"length":t.filesize=rt.toInt(s)||0;case"password":t[n]=s;break;case"type":s=rt.toLow(s);let r=s.split(/;/);t[n]=r[0].trim(),r[1]&&(t.charset=rt.toLow(r[1].split(/=/).pop().trim()));break}}else t[e[0]]=s})),t}async FetchLibUrl(t,e,s){return this.libjsBlob[t]||(this.libjsBlob[t]=this.URL(await this.getTable(this.LibStore).fetch({url:/^http/.test(t)?t:this.libPath+t,libjs:"script-",version:s||this.version,progress:e}))),this.libjsBlob[t]}async addLib(t,e,s){this.libjsBlob[t]||await this.addJS(await this.FetchLibUrl(t,e,s),!0,/\.css$/.test(t))}ajax(t){const e=new D,s=this;return t&&t.method||(t=s.FetchARG(t)),rt.Async((n=>{const r=[];let i=s.getName(t.url);e.on("readystatechange",(a=>{switch(e.readyState){case e.UNSENT:rt.tryA(e,t.success,r),n(r[0]);break;case e.HEADERS_RECEIVED:const a=rt.tryC(e,e.getAllResponseHeaders),o=s.FilterHeader(rt.toObj(rt.Mach(a.trim().split(/\n+/),(t=>rt.Mach(t.split(/:\s+/),(t=>rt.R(t.trim(),/^"(.+)"$/,"$1")))))));let l=t.type||o.type.split("/")[1].trim();switch(o.filename&&(i=o.filename),"head"!=l&&t.charset&&(l="u8"),r.push(o),l){case"u8":case"buf":e.responseType="arraybuffer";break;case"html":e.responseType="document";break;case"json":case"xml":e.responseType=l;break;case"file":case"blob":case"javascript":e.responseType="blob";break;case"svg":case"svg+xml":case"js":case"text":e.responseType="text";break;default:e.responseType=/(text|javascript|ini)/.test(o.type)?"text":"blob";break}break;case e.DONE:let c=r[0]&&r[0].type||s.getMime();if("head"!=t.type){let s=e.response;if(rt.blob(s)&&(s=rt.File([s],i,s.type||c)),rt.buf(s)&&(s=rt.toU8(s),t.charset)){s=rt.decode(s,t.charset);const e=t.type||c.split("/")[1].trim();"blob"==e&&(s=rt.File([s],i,s.type||c)),"buf"!=e&&"u8"!=e||(s=rt.encode(s))}if(r.unshift(s),200!=e.status)return rt.tryA(e,t.error,r),n(null)}rt.tryA(e,t.success,r),n(r[0]);break}})),e.on("progress",(s=>{rt.tryC(e,t.progress,!0,s.loaded,s.total,"")})),e.upload.on("progress",(s=>{rt.tryC(e,t.progress,!1,s.loaded,s.total,"")})),e.open(rt.toUp(t.method),t.href),rt.toArr(t.headers,(t=>{e.setRequestHeader(t[0],t[1])})),e.send(t.post)}))}async ZipWorker(t,e,s){if(!t)return t;let n=this;return await n.getMessage("unpack",t,(function(t,r){return async function(t){if(rt.nil(t.result)){if("progress"==t.state)e&&e(t.current,t.total,t.filename);else if("password"==t.state){let e=t.workerId,r=t.password;rt.buf(r)&&(r=rt.decode(r,"gbk")),r=!r&&rt.str(s)?s:rt.fn(s)?await s(t.password):F("请输入密码",t.password),!t.isUTF8&&r&&(r=rt.toGB2312(r)),n.postMessage({workerId:e,result:r||!1})}}else r(t.result||null),delete n.action[t.clientID]}}))}async ZipCompress(e,s,n,r,i){rt.nil(t.zip)&&await it.addLib("zip.min.js"),rt.bool(n)&&(r=n,n=x);const a=t.zip;if(!0===r){const t=new a.BlobWriter,r=new a.ZipWriter(t);let i;const o=t=>(i||(i=t.name),r.add(t.name,new a.BlobReader(t),{onprogress:(e,n)=>s&&s(e,n,t.name,"pack"),password:n}));return rt.buf(e)&&(e=rt.File([e],"unknow.data",it.getMime())),rt.blob(e)?await o(e):rt.ForOf(e,(async t=>{rt.array(t)?t=rt.File([t[1]],t[0],it.getMime(t[0])):rt.buf(t)&&(t=rt.File([t],"unknow.data",it.getMime())),await o(t)})),await r.close(),rt.File([await t.getData()],i+".zip",it.getMime("zip"))}{const t="Enter password.",r=await new a.ZipReader(new a.BlobReader(rt.blob(e)?e:rt.toBlob(e))).getEntries().catch((t=>null));let o;const l=e=>{let r;return e.encrypted&&n&&(r=rt.buf(n)?n:0==e.filenameUTF8?rt.toGB2312(n):rt.encode(n)),e.getData(new a.Uint8ArrayWriter,{rawPassword:r,onprogress:(t,n)=>{s&&s(t,n,e.filename,"unpack")}}).catch((async s=>{let r=s.message;if(!1!==n&&!i&&(r==a.ERR_INVALID_PASSWORD||r==a.ERR_ENCRYPTED)){if(rt.buf(n)&&(n=rt.decode(n,"gbk")),n=F(t,n))return await l(e);n=!1}}))};if(r)for await(let t of r){if(t.directory)continue;let e=await l(t);e&&(o||(o={}),o[t.filename]=e)}return o}}async Decompress(t,e,s,n){let r=t.slice(0,6);if(rt.blob(r)&&(r=await rt.toU8(r)),r=rt.toUp(rt.buf2str(r)),/^504B0304/.test(r))return it.ZipCompress(t,e,s,!1,n);let i=/^52617221/.test(r)?"rar":/^377ABCAF271C/.test(r)?"7z":x;if(!i)return null;t=await rt.toU8(t);const a=await it.FetchLibUrl(/7z$/.test(i)?"extract7z.zip":"libunrar.min.zip",e);return a?rt.Async((r=>{let i,o=new _(a);o.on("message",(t=>{if(rt.obj(t.data)){const{t:a,data:l,file:c,total:u,current:h,name:d}=t.data;if(1==a)r(i);else{if(2==a)return!i&&(i={}),l&&(i[c]=l);if(4==a)return u>0&&u>=h&&rt.tryC(e,e,h,u,d||c);if(-1===a)if(n)r(null);else{if(s=F(this.pwText,s||""))return o.postMessage({password:s});r(null)}}o.terminate()}})),o.on("error",(t=>{r(null),o.terminate()})),o.onmessageerror=t=>o.toEvent("error"),o.postMessage({contents:t,password:s})})):null}addJS(t,e,s){return rt.Async((n=>{s||!1===s||(s=rt.str(t)&&/\.css$/.test(t)||rt.file(t)&&/css$/.test(t.name)||!1);const r=this.URL(t);rt.fn(e)||(e=!1);const i=(s?g.head:g.body).appendChild(this.$ce(s?"link":"script")),a={type:this.getMime(s?"css":"js"),href:r,src:r,rel:O.name,crossorigin:"anonymous",load(t){this.un("error",a.error),n(e&&e(t)||t)},error(t){this.un("load",a.error),n(e&&e(t)||t)}};rt.setElm(i,a)}))}URL(t,e){return rt.str(t)&&t.length<255&&/^(blob|http|\/{1,2}(?!\*)|\.\/|.+\/)[^\n]*?$/i.test(t)?t:(e||(e=rt.blob(t)?t.type:"js"),p.createObjectURL(rt.blob(t)?t:new i([t],{type:this.getMime(e)})))}reURL(t){return p.revokeObjectURL(t)}customElement(t,e){if(!S.get(t)){const n=class extends w{constructor(){super();const t=this.dataset.callinit;this.tag_name=this.tagName.toLowerCase(),this.goFunc(t||"Init")}goFunc(t,...e){if(this[t])return this[t](...e);const s=this.tag_name.replace(/\-(\w)/,(t=>t[1].toUpperCase()));W.log(s+t),rt.tryA(this,it.action[s+t],e)}connectedCallback(...t){const e=this.dataset.callback;this.goFunc(e||"Connected",...t)}attributeChangedCallback(...t){const e=this.dataset.callattr;this.goFunc(e||"AttrChange",...t)}disconnectedCallback(...t){const e=this.dataset.callremove;this.goFunc(e||"Disconnected",...t)}};e&&s.assign(n.prototype,e),S.define(t,n)}}Err(t){return new Error(t)}async download(t,e,s){let n;return!e&&t&&(e=t,t=null),/^(http|blob:|data:)/.test(e)?(n=e,!t&&/^(http|blob:)/.test(e)&&(t=this.getName(e))):e&&(rt.file(e)&&(t=e.name),n=this.URL(e,s)),t||(t="explame.html"),rt.Async((e=>{const s=this.$ce("a");s.href=n,s.download=t,s.click(),s.remove(),e(!0)}))}toSet(t){(t=t||new class extends z{}).action=t.action||{};const{RF:e,CF:n,BF:r}=this;return s.assign(t,{RF:e,CF:n,BF:r}),t}$(t,e){return t?rt.str(t)?(e||g).querySelector(t):rt.fn(t)?it.docload(t):t:x}$$(t,e){return(e||g).querySelectorAll(t)||[]}$ce(t){return g.createElement(t||"div")}docElm(t,e){return(new E).parseFromString(t,e||g.contentType).documentElement}RF(t,e){return rt.tryA(this,this.action[t],e,!0)}CF(t,...e){return this.RF(t,e)}BF(t,e,...s){const n=this.action[t];return rt.fn(n)?rt.tryA(e,n,s):x}async toZip(t,e,s){return it.ZipCompress(t,e,s,!0)}upload(t,e,s){const n=this.$ce("input");rt.setElm(n,{type:a.name,accept:e,multiple:s,change(){this.remove(),rt.tryC(this,t,rt.toArr(this.files))},cancel(){this.remove()}}).click()}async postMessage(t,e){if(!e){e=(await navigator.serviceWorker.ready).active}rt.await(e)&&(e=await e),e&&e.postMessage(t)}getRandStr(){return btoa(rt.tryC(crypto,"randomUUID")||performance.now()+Math.random()).replace(/[^\w]/g,"")}toReplace(t,e){return rt.str(e)?t=rt.R(t,/{value}/,e):rt.obj(e)&&rt.toArr(e,(e=>t=rt.R(t,new b(e[0],"g"),e[1]))),t}getLang(t,e){return rt.none(it.language[t])||(t=it.language[t]),e?it.toReplace(t,e):t}getMessage(t,e,s){let n=this;return rt.Async((r=>{let i=n.getRandStr();n.action[i]=rt.fn(s)?s(i,r):function(t){r(t.result),n.action[i]=null,delete n.action[i],delete t.result,t=null},n.postMessage({clientID:i,method:t,result:e})}))}async getTemplate(t,e){let s=await this.getTable("libjs").ajax({url:"/template-"+t+".html",type:"text"});return rt.toArr(e,(t=>{s=s.replace(new b(t[0],"g"),t[1])})),s=s.replace(/\{[\w\-\_]+?\}/,""),s}getPath(t){return t&&rt.toStr(t.split("/").slice(0,-1),"/")+"/"}getName(t){return rt.str(t)?t.split("/").pop().split(/\?/)[0].split(/\#/)[0]:""}dirname(t,e){return e||(e=1),rt.toStr(this.getPath(t).split("/").slice(0,-1-e),"/")+"/"}getExt(t){return rt.toLow(this.getName(t).split(".").pop())}getKey(t){return rt.R(this.getName(t),/\.\w+$/)}exttype={};setMime(){this.extlist=rt.toObj([].concat(..."text;css,scss,sass,xml,vml,style:css,htm:html|php,txt:plain,m3u8:plain,js:javascript\nimage;jpg,jpeg,png,gif,webp,avif,apng,heic,svg:svg+xml\nfont;woff,woff2,ttf,otf\napplication;pdf,json,js:javascript,*:octet-stream,zip:zip|x-zip-compressed,rar:rar|x-rar-compressed,7z:7z|x-7z-compressed,wasm\naudio;ogg,wma,mp3,m4a:mp4\nvideo;mp4,mp2t".split(/\n/).map((t=>(t=t.split(/;/),[].concat(...t[1].split(/,/).map((e=>{let s=(e=e.split(/:/))[1]&&e[1].split("|")||[e[0]],n=[];for(let r=0;s[r];r++){let i=t[0]+"/"+s[r];this.exttype[i]=e[0],n.push([e[0],i])}return n}))))))))}getMime(t){return this.extlist||this.setMime(),t=t&&rt.toLow(t)||"",this.exttype[t]||/^\w+\/[\w\;]+$/.test(t)?t:(/^\w+$/.test(t)||(t=this.getExt(t)||t.split(".").pop()),this.extlist[t]||this.extlist["*"])}Mime(t){let e=this;if(e.extlist||e.setMime(),e.exttype[t])return e.exttype[t];if(t=t&&t.split("/").pop().split(";")[0].split("+")[0].trim())if(!1!==t.indexOf("x-")){if((t=t.match(/x\-(\w+)/))[1])return t[1]}else if(/^\w+$/.test(t))return t;return""}action={};docload(t){if("complete"==g.readyState)rt.tryC(this,t);else{const e=s=>{"complete"==g.readyState&&(rt.tryC(this,t),g.un("readystatechange",e))};g.on("readystatechange",e)}}showWin(t){let e=it.$ce("dialog");if(e.setAttribute("aria-modal","true"),t.id&&e.setAttribute("id",t.id),rt.addClass(e,"wbox",t.type||"blue"),t.class&&rt.addClass(e,...t.class),t.time&&(rt.str(t.time)&&rt.setStyle(e,"--wb-time",t.time),rt.addClass(e,"autoclose"),e.on("animationend",(function(){rt.removeClass(this,"autoclose"),this.toEvent("hide")}))),["title","content","foot"].forEach((s=>{let n=e.appendChild(it.$ce());if(rt.addClass(n,s),t[s]&&(n.innerHTML=t[s]),"title"==s){let t=n.appendChild(it.$ce("button"));t.innerHTML="&#61453;",rt.addClass(t,"close"),t.on("click",(function(t){t.preventDefault(),this.parentNode.parentNode.toEvent("hide")}))}"foot"==s&&t.action&&rt.toArr(t.action,(t=>{let e=n.appendChild(it.$ce("button"));e.innerHTML=t.title,rt.addClass(e,"action","w-btn"),t.css&&(e.style.cssText=t.css),e.on("click",t.click)}))})),!rt.bool(t.lock)){if("showPopover"in w.prototype)return e.popover="auto",e.on("hide",(function(){this.hidePopover(),this.toEvent("close")})),e.on("show",(function(){this.showPopover()})),g.body.appendChild(e),e.toEvent("show");if("showModal"in e)return e.on("hide",(function(){this.close("hide"),this.toEvent("close")})),e.on("show",(function(){this.showModal()})),g.body.appendChild(e),e.toEvent("show")}let s=it.$ce();return rt.addClass(s,"w-mask"),s.appendChild(e),g.body.appendChild(s),s.on("show",(function(){this.hidden=!1})),s.on("hide",(function(){this.hidden=!0,this.toEvent("close")})),e.on("hide",(function(){this.parentNode.toEvent("hide")})),e.on("show",(function(){this.parentNode.toEvent("show")})),!t.lock&&s.on("click",(function(t){t.target===this&&this.toEvent("hide")})),s.toEvent("show"),s}constructor(){super();const e=this;s.assign(t,{T:e,I:rt}),rt.defines(t,{Nenge:e},1),s.assign(z.prototype,{on(t,e,s){return this.addEventListener(t,e,s),this},un(t,e,s){return this.removeEventListener(t,e,s),this},once(t,e,n){return this.on(t,e,s.assign({passive:!1,once:!0},!0===n?{passive:!0}:n||{})),this},toEvent(t,e){return this.dispatchEvent("string"==typeof t?new R(t,{detail:e}):t),this}}),s.assign(w.prototype,{AddStyle(t,s){const n=e.css;return rt.num(this.RuleIndex)?s?n.setCSS(t,this.RuleIndex):t&&n.pushCSS(t,this.RuleIndex):this.RuleIndex=n.Elm2Rule(this,t),this.RuleIndex},SetCSS(t){return this.AddStyle(t,!0),this},RuleItem(){return e.css.ruleItem(this.AddStyle())},GetRule(){return e.css.getRule(this.RuleIndex)},GetCSS(){return e.css.getCSS(this.RuleIndex)},NewRule(){return e.css.NewRule(this.AddStyle())},AddMeida(t){return this.NewRule().addMedia(t)},RemoveRule(){return rt.num(this.RuleIndex)&&e.css.delRule(this.RuleIndex),this}});let{language:n,onLine:r}=navigator,{readyState:i,currentScript:a,characterSet:o}=g,l=a&&a.src.split(/\?/),c=l&&e.getPath(l[0]),u=rt.toLow(n).split("-");if("zh"==u[0]&&("cn"==u[1]?u[1]="hans":"hk"!=u[1]&&(u[1]="hant")),s.assign(e,{I:rt,JSpath:c,libPath:c+"lib/",ROOT:e.dirname(c,2),i18nName:rt.toStr(u,"-"),langName:n,onLine:r,readyState:i,isTouch:rt.I(w,"ontouchstart"),css:new st}),a){let t=a.dataset;e.debug=t.debug,t.sw&&(e.SW=new nt(e,"/sw.js"),s.assign(e.action,{pwa_loader(){let t=e.$("#footer");if(t){let s=t.appendChild(this.$ce("button"));s.innerHTML="PWA操作",s.on("click",(async function(t){t.preventDefault();let s=e.$("#pwa_tag");if(!s)return e.showWin({id:"pwa_tag",class:["min"],title:"ServiceWorker管理",content:"缓存是指ServiceWorker中的caches缓存下来的web请求.<p>感觉数据被缓存,点击清空缓存!</p>",action:[{title:"更新脚本",click(){e.SW.postSync("update")}},{title:"更新缓存",click(){e.SW.postSync("cache_check")}},{title:"清空缓存",click(){e.SW.postSync("cache_clear")}},{title:"卸载",click(){e.SW.postSync("unregister")}},{title:"刷新页面",click(){T.reload()}}],lock:!0,time:"5s"});s.toEvent("show")}))}},notification_error(){e.showWin({title:"警告",content:"通知权限被禁止",lock:!0,time:"3s"})},pwa_activate(){e.showWin({title:"提醒!",content:"ServiceWorker 安装成功!",action:[{title:"更新缓存(建议)",click(){e.SW.postSync("cache_check")}},{title:"清空缓存",click(){e.SW.postSync("cache_clear")}},{title:"刷新页面",click(){T.reload()}}],lock:!0,time:"3s"})},pwa_cache_update(t){e.showWin({title:"提醒",content:"本站缓存更新"+t.result+"个文件",time:"2s"})},pwa_cache_clear(){e.showWin({title:"提醒",content:"Caches缓存已被清空!",lock:!0})},pwa_cache_delete(){e.showWin({title:"提醒",content:"本站缓存已被清空!",time:"2s"})},pwa_update(){e.showWin({title:"提醒",content:"脚本更新检测完毕!",lock:!0})},pwa_remove(){e.showWin({title:"提醒",content:"已经替你卸载脚本,请关闭网站!",lock:!0}).on("close",(function(){T.href="about:blank",window.close()}))}})),e.docload((async s=>{const{router:n,fonts:r,version:i}=t;e.version=i?v(i):e.version;const a=e.dirname(e.JSpath);r&&rt.toArr(new Set(r.split(",")),(t=>e.getTable("libjs").fetch({url:a+t.split(":")[1],key:!0}).then((s=>e.css.addFont(s,t.split(":")[0]))))),n&&await rt.Async(rt.toArr(new Set(n.split(",")),(t=>t&&e.addJS(e.JSpath+"router/"+t+".js?"+e.version,!0,!1)))),e.toEvent("ready")}))}}};window.onerror=t=>j(t)}));