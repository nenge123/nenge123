/**
 * @author Nenge<m@nenge.net>
 * @copyright Nenge.net
 * @license GPL
 * @link https://nenge.net
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t="undefined"!=typeof globalThis?globalThis:t||self)}(this,(function(t){"use strict";const{Array:e,Object:s,String:r,Number:n,Blob:a,File:i,ArrayBuffer:o,Uint8Array:l,Function:c,Boolean:u,Promise:h,FormData:d,URL:p,URLSearchParams:f,TextDecoder:m,TextEncoder:y,document:g,RegExp:b,HTMLElement:w,customElements:S,parseInt:R,Date:v,CustomEvent:A,JSON:C,indexedDB:F,undefined:x,DOMParser:j,prompt:k,alert:E,fetch:I,Response:L,Headers:M,XMLHttpRequest:D,location:T,matchMedia:B,styleMedia:N,Node:U,NodeList:O,StyleSheet:z,console:P,EventTarget:$,Worker:W,Attr:_,Text:G,Document:H,Symbol:J,CSSStyleDeclaration:K,CSSConditionRule:V,NamedNodeMap:q,Event:Z,KeyboardEvent:X,IDBCursorWithValue:Y,Notification:Q}=self;class tt{tables=[];Store={};constructor(t,e){e=e||{},s.assign(this,{name:t,config:e})}open(t){const e=this;return nt.Async((s=>{const r=F.open(e.name,e.version);r.once("upgradeneeded",nt.fn(t)?t:t=>{const s=r.result;nt.toArr(e.config,(t=>{const[e,r]=t;if(!s.objectStoreNames.contains(e)){const t=s.createObjectStore(e);nt.toArr(r,(e=>{t.createIndex(e[0],e[0],e[1]||{unique:!1})}))}}))}),r.once("success",(async()=>{const n=r.result;return e.tables=nt.toArr(n.objectStoreNames),e.version=n.version+1,nt.toArr(e.config).filter((t=>!e.tables.includes(t[0])))[0]?(n.close(),s(e.open(t))):(e.Store={},s(n))}))}))}table(t,e){const s=this;return s.Store[t]||(s.config[t]||(s.config[t]=e||{}),s.Store[t]=new et(t,s)),s.Store[t]}async remove(){const t=this;return t.db&&(await t.db).close(),t.db=x,F.deleteDatabase(t.name)}async delete(t){const e=this;e.db||nt.toArr(await F.databases(),(t=>{e.name===t.name&&(e.version=t.version+1)})),e.db=e.open((s=>{let r=s.target.result;nt.str(t)&&(t=[t]),nt.toArr(t,(t=>{r.objectStoreNames.contains(t)&&r.deleteObjectStore(t),e.config[t]&&(delete e.config[t],delete e.Store[t])}))}))}}class et{maxsize=104857600;part="-part-";constructor(t,e){nt.defines(this,{table:t,IDB:e},1)}async ObjectStore(t){const e=this.IDB;e.db||(e.db=e.open());return(await(await e.db).transaction([this.table],t?x:"readwrite")).objectStore(this.table)}read(){return this.ObjectStore(!0)}write(){return this.ObjectStore()}async readCall(t,...e){return nt.tryA(await this.read(),t,e)}async writeCall(t,...e){return nt.tryA(await this.write(),t,e)}Result(t,e){return nt.Async((s=>t.on("success",(r=>{const n=t.result;e?e(s,n):s(n)}))))}getItem(t,e){return this.get(t,e)}setItem(t,e){return this.put(e,t)}async clear(){return this.Result(await this.writeCall("clear"))}async count(t){return this.Result(await this.readCall("count",t))}async all(t,e){return this.Result(await this.readCall("getAll",t,e))}async keys(t,e){return this.Result(await this.readCall("getAllKeys",t,e))}async key(t){return this.Result(await this.readCall("getKey",t))}load(t,e){return this.Result(t.get(e))}save(t,e,s){return this.Result(t.put(e,s))}async cursor(t,e){return this.getCursor(await this.readCall("openCursor",t,e))}async keyCursor(t,e){return this.getCursor(await this.readCall("openKeyCursor",t,e))}index(t){return{DB:this,keyPath:t,async read(){const t=await this.DB.read();return t.indexNames.contains(this.keyPath)?t.index(this.keyPath):t},async method(t,...e){return nt.tryA(await this.read(),t,e)},async cursor(t,e){return this.DB.getCursor(await this.method("openCursor",t,e))},async keyCursor(t,e){return this.DB.getCursor(await this.method("openKeyCursor",t,e))},async getItem(t,e,s){return this.DB.get(t,e,await this.read())},async get(t){return this.DB.Result(await this.method("get",t))},async count(t){return this.DB.Result(await this.method("count",t))},async key(t){return this.DB.Result(await this.method("getKey",t))},async keys(t,e){return this.DB.Result(await this.method("getAllKeys",t,e))},async all(t,e){return this.DB.Result(await this.method("getAll",t,e))}}}getCursor(t){const e={};return this.Result(t,((t,s)=>{s?(e[s.primaryKey]=nt.F(s,Y)?s.value:s.key,s.continue()):t(e)}))}async get(t,e,s){const r=this;if(s=s||await r.read(),nt.str(t)){let n=await r.load(s,t);if(!n||e&&n.version&&n.version!=e)return;if(nt.blob(n.contents)||nt.buf(n.contents)){const e=r.maxsize;if(n.filesize>e){let a=n.contents.byteLength||n.contents.size;const o=[n.contents];let l=1;for(;;){let i=n.filesize-a;if(i<=0)break;let c=await r.load(s,t+this.part+l);c&&o.push(c.contents),l+=1,a=i>=e?a+e:n.filesize}n.contents=nt.File(o,n.filename,n.filesize),n.type!=i.name&&(n.contents=await nt.toU8(n.contents))}}return n}if(nt.array(t))return nt.toObj(nt.Async(t.map((async t=>[t,await r.load(s,t)]))))}async put(t,e){const r=await this.write();if(!e){if(nt.str(t))return;if(nt.array(t))return nt.Async(t.map((t=>this.put(t))));if(nt.obj(t)){let s=r.indexNames;if(!t[s])return nt.Async(nt.toArr(t,(t=>this.put(t[1],t[0]))));e=t[s]}}if(nt.blob(t.contents)||nt.buf(t.contents)){const n=t.contents.byteLength||t.contents.size,a=this.maxsize;if(n>a){let i=0,o=0;const l={};for(let e in t)"contents"!==e&&(l[e]=t[e]);for(;;){let c=n-i;if(c<=0)break;let u=c>=a?i+a:n,h=t.contents.slice(i,u),d=0==o?"":this.part+o;await this.save(r,s.assign({contents:h},l),e+d),i=u,o+=1}return}}return this.save(r,t,e)}async putdata(t,e,r,n){const a=s.assign({contents:e,timestamp:new v},n);return r&&(a.version=r),this.put(a,t)}async getdata(t,e){const s=await this.get(t,e);return s&&s.contents||s}async delete(t,e){const s=this,r=await s.write();let n=await s.Result(r.getAllKeys());return nt.Async(n.map((n=>t==n||nt.array(t)&&t.includes(n)||e&&0===n.indexOf(t)?s.Result(r.delete(n)):void 0)))}async fetch(t){let e=(t=at.FetchARG(t)).key,n=await this.get(e,t.version);if(n&&n.timestamp){if(at.onLine&&t.modified&&n.modified){let e=await at.FetchData({url:t.href,type:"head"});e&&e["last-modified"]!=n.modified&&(n=null)}if(null!=n)return n.type==H.name?at.docElm(n.contents):n.contents}let[a,o]=await at.FetchFile(t);if(a){if(nt.blob(a)){const n={filesize:a.size,filetype:a.type,filename:e,type:i.name,mode:"fetch",timestamp:new v};let c;if(t.options&&s.assign(n,t.options),t.version&&(n.version=t.version),o&&o["last-modified"]&&(n.modified=o["last-modified"]),t.unpack){if(a=await at.Decompress(a,((e,s,r)=>{nt.tryC(t,"progress",e,s,r,"unpack")}))||a,t.libjs&&nt.obj(a)){let t;return nt.toArr(a,((r,a)=>{const i=at.LibPad+r[0],o=at.getMime(r[0]),l=nt.File([r[1]],i,o);this.put(s.assign({contents:l},n,{filename:i,filesize:l.size}),i),i===e&&(t=l)})),t||a}c=nt.buf(a)?l.name:"unpack"}else t.type&&"blob"==t.type||(a=await at.toFormatBlob(a,t.type,o),c=nt.str(a)?r.name:nt.obj(a)?"json":l.name,"html"==t.type&&(c=H.name));if(c&&(n.type=c),this.put(s.assign({contents:a},n),e),"html"==t.type&&nt.str(a))return at.docElm(a)}else"head"==t.type&&this.put({contents:a,modified:a["last-modified"],timestamp:new v},e);return a}return null}async ajax(t,e){const s=this;return nt.Async((async n=>{let a=(t=at.FetchARG(t,{async success(o,c){if(!o)return n({});const u={mode:"ajax",timestamp:new v};let h;if(c?(u.headers=c,u.filetype=c.type,u.modified=c["last-modified"],nt.F(o,H)?(u.contents=o.documentElement.outerHTML,h=H.name):(u.contents=o,h=nt.obj(o)?"json":nt.blob(o)?i.name:nt.buf(o)?l.name:r.name)):(u.contents=o,h=M.name),h&&(u.type=h),t.version&&(u.version=t.version),await s.put(u,a),e)return n(o);u.type==H.name&&(u.contents=o),n(u)},error(t,e){n({})}})).key||t.href;const o=await s.get(a,t.version);if(o&&o.timestamp)return o.type==H.name&&(o.contents=at.docElm(o.contents)),n(e?o.contents:o);at.ajax(t)}))}}class st{constructor(t,e){this.sheet=t&&t.cssRules?t:g.head.appendChild(g.createElement("style")).sheet,t&&!t.cssRules&&(this.selectorText=e)}selectorText="";insertRule(t,e){if(this.selectorText){const e=this.selectorText;t=(t=["&",":"].includes(t.charAt(0))?"&"==t.charAt(0)?t.replace(/^&/,e):e+t:e+" "+t).replace(/&/g,e)}return nt.tryC(this.sheet,"insertRule",t,nt.num(e)?e:this.ruleLast())}delRule(t){const e=this.ruleItem(t);if(e&&(this.ruleStyle(e).cssText="",e.cssRules))for(;e.cssRules.length;)e.cssRules.deleteRule(0)}addRule(t,e){return nt.num(e)&&this.ruleItem(e)?(this.sheet.deleteRule(e),this.insertRule(t,e)):this.insertRule(t)}ruleItem(t){return nt.num(t)?(t<0&&(t=this.ruleLast()+t+1),this.sheet.cssRules.item(t)||null):null}ruleStyle(t){if(nt.num(t)&&(t=this.ruleItem(t)),t)return t.ownerNode?t.ownerNode.style:t.style}getRule(t){const e=this.ruleItem(t);return e?this.ruleData(e):{}}ruleData(t,e){if(nt.num(t)&&(t=this.ruleItem(t)),t){let s=this.ruleStyle(t),r=nt.toObj(s)||{},n=e&&this.rulesData(t)||[];return n.length&&(r.cssRules=n),r}}rulesData(t){nt.num(t)?t=this.ruleItem(t):nt.nil(t)&&(t=this.sheet);const e=[],s=[];if(t.cssRules)for(let r of t.cssRules)if(nt.F(r,CSSStyleRule))e.push({[r.selectorText]:this.ruleData(r,!0)});else if(nt.F(r,CSSFontFaceRule))s.push({"@font-face":this.ruleData(r)});else if(nt.F(r,V)){const t=nt.O(r).name.toLowerCase().slice(3,-4);s.push({["@"+t+" "+r.conditionText]:this.rulesData(r)})}else P.log(r);return e.concat(s)}ruleLast(){return this.sheet.cssRules.length}pushCSS(t,e){const s=this.ruleStyle(e);s&&(s.cssText+=t)}setCSS(t,e){const s=this.ruleStyle(e);s&&(s.cssText=t||"")}getCSS(t){const e=this.ruleStyle(t);return e?e.cssText:""}addMedia(t){const e=this.addRule("@media "+t+"{}");return this.NewRule(e)}NewRule(t){const e=this.ruleItem(t);return e?new this.constructor(e,e.selectorText):null}ElmId(t){if(nt.F(this.sheet,CSSStyleRule)||this.selectorText)return this.ElmClass(t);let e=t.getAttribute("id");return e||(e="elm-"+at.getRandStr(),t.setAttribute("id",e)),"#"+e}ElmGetClass(t,e){if(e)for(let e of t.classList)if(/^elm\-\w{23,*}/.test(e))return e;let s="elm-"+at.getRandStr();return t.classList.add(s),s}ElmClass(t){return"."+this.ElmGetClass(t,!0)}Elm2Rule(t,e,s,r){return e=e||"",r=r||"",this.addRule(this.ElmId(t)+r+"{"+e+"}",s)}Elm2Icon(t,e,s,r){if(nt.nil(r))r=this.fontSelete[0];else{if(!0===r)return nt.Mach(this.fontSelete,(r=>this.Elm2Icon(t,e,s,r)))[0];if(nt.array(r))return nt.Mach(r,(r=>this.Elm2Icon(t,e,s,r)))[0]}return s||(s=this.iconFont),this.Elm2Rule(t,`content:"\\${e}";font-family:"${s}";`,!1,r)}Elm2font(t,e,s,r){return isNaN(e)&&!/^&#/.test(e)&&(e=R(e,16)),nt.num(e)&&(e="&#"+e+";"),t.innerHTML=e,this.Elm2Rule(t,`font-family:"${s}";`,!1,r)}fonts=g.fonts;fontList(){return e.from(this.fonts.keys(),(t=>t.family))}fontMime=["woff2","woff","svg","eot","truetype"].filter((t=>CSS.supports("font-format("+t+")")));fontSelete=[":before",":after"];fontCSS="display: inline-block;font-style: normal;font-weight: normal;-webkit-font-smoothing: antialiased;-moz-osx-font-smoothing: grayscale;";iconFont="web-icon";async addFont(t,e,s){e||(e=this.iconFont),nt.str(t)&&(t="url("+t+")");const r=new FontFace(e,t,s||{"font-weight":"normal","font-style":"normal"});this.fonts.add(/blob:/.test(t)?r:await r.load())}addIcon(t,e,s,r){if(r){if(!0===r)return nt.Mach(this.fontSelete,(r=>this.addIcon(t,e,s,r)))[0];if(nt.array(r))return nt.Mach(r,(r=>this.addIcon(t,e,s,r)))[0]}else r=this.fontSelete[0];s||(s=this.iconFont);const n=s+"-"+t;return at.fontsIcon[t]=n,this.addRule(`.${n+r}{${this.fontCSS}font-family:"${s}";content:"${e}"}`),n}getIcon(t){return at.fontsIcon[t]}onMedia(t,e){if(B){let s=B(t);return s.on("change",(t=>e(t.matches,t))),e(s.matches),s}}}class rt{constructor(t,e){let s=navigator.serviceWorker;s?(s.register(e).then((e=>{e.installing&&this.connect(e.installing,"register");(e.installing||e.active).on("statechange",(t=>{const e=t.target;["redundant","activated"].includes(e.state)&&this.connect(e,"register")})),t.toEvent("pwaload")})),this.ready=nt.Async((async t=>{let e=navigator.serviceWorker;if(nt.await(e.ready)){await e.ready;e.on("message",this._message),e.on("controllerchange",(t=>this.connect(t.active,"register"))),t(!0)}else t(!1)})),Q&&!Q.permission&&Q.requestPermission()):this.ok=nt.Async(!1)}async _message(t){let e=t.data,s=t.source;if(at.isLocal&&P.log(e),nt.obj(e)){let t=e.clientID,r=e.method;t&&nt.fn(at.action[t])?await at.action[t](e,s):r&&nt.fn(at.action[r])&&await at.action[r](e,s),t=null,r=null,e=null}}async connect(t,e){(t=t||(await navigator.serviceWorker.ready).active).postMessage({method:e||"connect"})}async clear(){let t=await navigator.serviceWorker.getRegistrations();nt.Each(t,(t=>t.unregister()))}async permission(t){let e=await navigator.permissions.query({name:t}).catch((t=>null));return!(!e||"granted"!=e.state)}async notice(t,e){await this.permission("notifications")&&(await navigator.serviceWorker.ready).showNotification(t,e)}async sync(t){await this.permission("background-sync")&&(await navigator.serviceWorker.ready).sync(t)}async periodicSync(t,e,s){await this.permission("periodic-background-sync")&&(await navigator.serviceWorker.ready).periodicSync.register(t,e)}async update(){return(await navigator.serviceWorker.ready).update()}async setPush(t){if(!await this.permission("push"))return;let e=await navigator.serviceWorker.ready,s=await e.pushManager.permissionState({userVisibleOnly:!0,applicationServerKey:t});if(P.log(s),"granted"==s){let s=await e.pushManager.getSubscription();s||(s=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:t})),P.log(s)}}}s.assign($.prototype,{on(t,e,s){return this.addEventListener(t,e,s),this},un(t,e,s){return this.removeEventListener(t,e,s),this},once(t,e,r){return this.on(t,e,s.assign({passive:!1,once:!0},!0===r?{passive:!0}:r||{})),this},toEvent(t,e){return this.dispatchEvent(new A(t,{detail:e})),this}}),s.assign(w.prototype,{AddStyle(t,e){const s=at.css;return nt.num(this.RuleIndex)?e?s.setCSS(t,this.RuleIndex):t&&s.pushCSS(t,this.RuleIndex):this.RuleIndex=s.Elm2Rule(this,t),this.RuleIndex},SetCSS(t){return this.AddStyle(t,!0),this},RuleItem(){return at.css.ruleItem(this.AddStyle())},GetRule(){return at.css.getRule(this.RuleIndex)},GetCSS(){return at.css.getCSS(this.RuleIndex)},NewRule(){return at.css.NewRule(this.AddStyle())},AddMeida(t){return this.NewRule().addMedia(t)},RemoveRule(){return nt.num(this.RuleIndex)&&at.css.delRule(this.RuleIndex),this}});const nt={R:(t,e,s)=>nt.tryC(t,"replace",e,nt.nil(s)?"":s)||"",F:(t,e)=>t instanceof e,C:(t,e)=>!nt.nil(t)&&nt.O(t)===e,O:t=>!nt.nil(t)&&t.constructor,P:t=>t.prototype,I:(t,e)=>e in nt.P(t),Each:(t,e)=>nt.fn(e)?t.forEach(e):t,Mach:(t,s)=>e.from(t,s),elm:t=>nt.F(t,w),await:t=>nt.F(t,h),blob:t=>nt.F(t,a),file:t=>nt.F(t,i),fn:t=>nt.F(t,c),func:t=>nt.fn(t),array:t=>e.isArray(t),obj:t=>nt.C(t,s),buf:t=>nt.C(t&&t.buffer||t,o),u8buf:t=>nt.C(t,l),str:t=>nt.C(t,r),bool:t=>nt.C(t,u),num:t=>nt.C(t,n),null:t=>null===t,none:t=>t===x,nil:t=>nt.null(t)||nt.none(t),toBuf:t=>t.arrayBuffer(),Blob2U8:async t=>nt.toU8(await nt.toBuf(t)),toBlob:t=>nt.blob(t)?t:new a([t.buffer||t]),toU8:t=>nt.u8buf(t)?t:nt.blob(t)?nt.Blob2U8(t):new l(t&&t.buffer||t),toStr:(t,e)=>nt.array(t)?t.join(e||""):t?t.toString(e):"",buf2str:t=>nt.toArr(t,(t=>nt.toStr(t,16).padStart(2,"0"))),toUp:t=>nt.array(t)?nt.toUp(nt.toStr(t)):t&&t.toUpperCase(),toLow:t=>nt.array(t)?nt.toLow(nt.toStr(t)):t&&t.toLowerCase(),decode:(t,e)=>new m(e).decode(t),encode:t=>(new y).encode(t),toCp437(t){const e="\0☺☻♥♦♣♠•◘○◙♂♀♪♫☼►◄↕‼¶§▬↨↑↓→←∟↔▲▼ !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~⌂ÇüéâäàåçêëèïîìÄÅÉæÆôöòûùÿÖÜ¢£¥₧ƒáíóúñÑªº¿⌐¬½¼¡«»░▒▓│┤╡╢╖╕╣║╗╝╜╛┐└┴┬├─┼╞╟╚╔╩╦╠═╬╧╨╤╥╙╘╒╓╫╪┘┌█▄▌▐▀αßΓπΣσµτΦΘΩδ∞φε∩≡±≥≤⌠⌡÷≈°∙·√ⁿ²■\n";return nt.buf(t)?nt.toStr(nt.toArr(t,(t=>e.charAt(t)))):nt.str(t)?nt.toU8(nt.toArr(t,(t=>e.indexOf(t)))):void 0},toInt:(t,e)=>R(t,e),Async:(t,e)=>nt.array(t)?e?h.allSettled(t):h.all(t):nt.fn(t)?new h(t,e):h.resolve(t),getAttr:t=>nt.EachItem(t.attributes||t,!1),setAttr:(t,e)=>(nt.toArr(e,(e=>t.setAttribute(...e))),t),setElm(t,e){let s=nt.O(t);return nt.toArr(e,(e=>{nt.str(e[1])&&!nt.I(s,e[0])?t.setAttribute(...e):nt.fn(e[1])&&nt.I(s,"on"+e[0])?t.once(e[0],e[1]):t[e[0]]=e[1]})),t},tryC:(t,e,...s)=>nt.tryA(t,e,s),tryA(t,e,s,r){if(!nt.nil(t))return e&&nt.str(e)&&(e=t[e]),nt.fn(e)?e.apply(t,s):r?e:x},ForOf(t,e){if(nt.array(t))return nt.Mach(t,e);const r=[];if(!t[J.iterator])return nt.F(t,s)?nt.Mach(s.entries(t),e):r;let n=0;for(const s of t){let a;nt.fn(e)?a=e(s):nt.array(s)?a=s[0]===n?s[1]:s:s&&(a=nt.str(s)&&t.getPropertyValue?[s,t.getPropertyValue(s)]:nt.F(s,_)?[s.name,s.value]:s),n+=1,r.push(a)}return r},EachItem(t,e){const r=nt.ForOf(t);return!1===e?s.fromEntries(r.map(((t,e)=>nt.array(t)&&2==t.length?t:[e,t]))):r},define:(t,e,r,n,a)=>s.defineProperty(t,e,!n||r&&r.value?r:{get:nt.fn(r)?r:()=>r,configurable:1==a}),defines:(t,e,r,n)=>r?nt.toArr(e,(e=>nt.define(t,e[0],e[1],1,n))):s.defineProperties(t,e),empty:t=>!!(nt.nil(t)||nt.str(t)&&!t||nt.array(t)&&!t.length||nt.obj(t)&&!nt.ForOf(t).length),Json:t=>(nt.u8buf(t)&&(t=nt.decode(t)),nt.str(t)?new c("return "+t)():t),toJson:t=>C.stringify(nt.Json(t)),File:(t,e,s)=>new i(t,e,{type:s,lastModified:v.now()}),toPost(t){const e=t instanceof d?t:new d(t instanceof HTMLFormElement?t:x);return nt.obj(t)&&nt.toArr(t,(t=>e.append(t[0],t[1]))),e},toGet(t,...e){let[s,r]=t.split(/\?/);return r=new f(r),nt.Each(e,(t=>{nt.str(t)&&(t=new f(t)),nt.toArr(t,(t=>r.set(t[0],t[1])))})),s+(r.size?"?"+nt.toStr(r):"")},toObj:t=>nt.obj(t)?t:nt.EachItem(t,!1),toArr:(t,e)=>t?(t=nt.array(t)?t:nt.obj(t)?s.entries(t):nt.num(t)||t.byteLength?nt.Mach(nt.toU8(t.buffer||t)):nt.EachItem(t,!0),nt.Mach(t,e)):[]},at=new class extends ${version=1;DB_NAME="NENGE.NET";DB_STORE_MAP={libjs:{},myfile:{timestamp:!1}};LibStore="libjs";LibPad="script-";language={};StoreList={};libjsBlob={};fontsIcon={};isLocal=/^(127|localhost)/.test(T.host);CLASS={CustomStore:tt,CustomTable:et,CustomCSS:st};getTable(t,e,s,r){return t?nt.str(t)?(s||(s=at.DB_NAME,r=r||at.DB_STORE_MAP),at.StoreList[s]||(at.StoreList[s]=new tt(s,r)),at.StoreList[s].table(t,e)):t:null}async FetchCache(t,e,s,r){e=e||"blob";let n=await caches.open(r||at.DB_NAME),a=await n.match(t);if((!a||s&&new v-v.parse(a.headers.get("date"))>s)&&(a=await I(t),a&&n.put(a.url,a.clone())),a)return a[e]()}FetchARG(t,e){return(t=s.assign({url:T.href},nt.str(t)?{url:t}:t,e)).key=!0===t.key?this.getName(t.url)||"index.html":t.key||t.url,t.libjs&&(/\.zip$/.test(t.key)&&(t.key=t.key.replace(/\.zip$/,".js"),t.unpack=!0),t.key=at.LibPad+this.getName(t.key),t.version||(t.version=this.version),t.type="blob"),t.headers=s.assign({"ajax-fetch":"ajax"},t.headers||{}),t.json?(t.post=nt.obj(t.json)?nt.toJson(t.json):t.json,t.headers.accept=at.getMime(nt.obj(post)?"json":"*"),delete t.json):t.post&&(t.post=nt.toPost(t.post)),"head"!=t.method&&t.post?t.method="post":t.method=t.method||"get",t.href=nt.toGet(t.url,t.params),/^http/.test(t.href)&&!t.corss&&-1===t.href.indexOf(T.origin)&&(t.cross=!1,t.headers=x),t}async FetchFile(t){t&&t.method||(t=this.FetchARG(t));const e=await I(t.href,{method:nt.toUp(t.method),body:t.post||x,headers:t.headers}).catch((e=>{nt.tryC(t,"error",!0,e)}));if(e){const s=this.FilterHeader(nt.toObj(e.headers)),r=s.filename||this.getName(t.key),n=s.type;if(200==e.status){if("head"==t.type)return[s];{const a=e.body.getReader(),i=[],o=s.length;let l=0;for(;;){const{done:e,value:n}=await a.read();if(e)break;i.push(nt.tryC(a,t.reader,n,l,o,s)||n),l+=n.byteLength,nt.tryC(t,"progress",l,o,r,"fetch")}return[nt.File(i,r,n),s]}}{let s;s="json"==n?await e.json():await e.text(),nt.tryC(t,"error",s)}}return[null,null]}async toFormatBlob(t,e,s){return t=await nt.toU8(t),e&&"u8"!=e&&(t=nt.decode(t,s.charset)),"json"==e&&/json$/.test(s.type)&&(t=nt.Json(t)),t}async FetchData(t){t&&t.method||(t=this.FetchARG(t));let[e,s]=await this.FetchFile(t);return e&&(nt.blob(e)&&(t.unpack?e=await at.Decompress(e,((e,s,r)=>{nt.tryC(t,"progress",e,s,r,"unpack")}),t.password||s.password)||e:t.type&&"blob"==t.type||(e=await at.toFormatBlob(e,t.type,s))),nt.tryC(t,"success",e,s)),e}FilterHeader(t){return nt.toArr(t,(e=>{let s=decodeURI(e[1]);if(nt.num(s)?s=parseFloat(s):/GMT$/.test(s)&&(s=new v(s)),/content-/.test(e[0])){t[e[0]]=s;let r=nt.R(e[0],/content-/);switch(r){case"disposition":let e=s.match(/^attachment;\s*filename=[\"\']+?(.+)[\"\']+?$/i);e&&e[1]&&(t.filename=decodeURI(e[1]));break;case"length":t.filesize=nt.toInt(s)||0;case"password":t[r]=s;break;case"type":s=nt.toLow(s);let n=s.split(/;/);t[r]=n[0].trim(),n[1]&&(t.charset=nt.toLow(n[1].split(/=/).pop().trim()));break}}else t[e[0]]=s})),t}async FetchLibUrl(t,e,s){return this.libjsBlob[t]||(this.libjsBlob[t]=this.URL(await this.getTable(this.LibStore).fetch({url:/^http/.test(t)?t:this.libPath+t,libjs:!0,version:s||this.version,progress:e}))),this.libjsBlob[t]}async addLib(t,e,s){this.libjsBlob[t]||await this.addJS(await this.FetchLibUrl(t,e,s),!0,/\.css$/.test(t))}ajax(t){const e=new D,s=this;return t&&t.method||(t=s.FetchARG(t)),nt.Async((r=>{const n=[];let a=s.getName(t.url);e.on("readystatechange",(i=>{switch(e.readyState){case e.UNSENT:nt.tryA(e,t.success,n),r(n[0]);break;case e.HEADERS_RECEIVED:const i=nt.tryC(e,e.getAllResponseHeaders),o=s.FilterHeader(nt.toObj(nt.Mach(i.trim().split(/\n+/),(t=>nt.Mach(t.split(/:\s+/),(t=>nt.R(t.trim(),/^"(.+)"$/,"$1")))))));let l=t.type||o.type.split("/")[1].trim();switch(o.filename&&(a=o.filename),"head"!=l&&t.charset&&(l="u8"),n.push(o),l){case"u8":case"buf":e.responseType="arraybuffer";break;case"html":e.responseType="document";break;case"json":case"xml":e.responseType=l;break;case"file":case"blob":case"javascript":e.responseType="blob";break;case"svg":case"svg+xml":case"js":case"text":e.responseType="text";break;default:e.responseType=/(text|javascript|ini)/.test(o.type)?"text":"blob";break}break;case e.DONE:let c=n[0]&&n[0].type||s.getMime();if("head"!=t.type){let s=e.response;if(nt.blob(s)&&(s=nt.File([s],a,s.type||c)),nt.buf(s)&&(s=nt.toU8(s),t.charset)){s=nt.decode(s,t.charset);const e=t.type||c.split("/")[1].trim();"blob"==e&&(s=nt.File([s],a,s.type||c)),"buf"!=e&&"u8"!=e||(s=nt.encode(s))}if(n.unshift(s),200!=e.status)return nt.tryA(e,t.error,n),r(null)}nt.tryA(e,t.success,n),r(n[0]);break}})),e.on("progress",(s=>{nt.tryC(e,t.progress,!0,s.loaded,s.total,"")})),e.upload.on("progress",(s=>{nt.tryC(e,t.progress,!1,s.loaded,s.total,"")})),e.open(nt.toUp(t.method),t.href),nt.toArr(t.headers,(t=>{e.setRequestHeader(t[0],t[1])})),e.send(t.post)}))}async ZipWorker(t,e,s){if(!t)return t;let r=this;return await r.getMessage("unpack",t,(function(t,n){return async function(t){if(nt.nil(t.result)){if("progress"==t.state)e&&e(t.current,t.total,t.filename);else if("password"==t.state){let e=t.workerId,n=t.password;nt.buf(n)&&(n=nt.decode(n,"gbk")),n=!n&&nt.str(s)?s:nt.fn(s)?await s(t.password):k("请输入密码",t.password),!t.isUTF8&&n&&(n=r.str2gb2312(n)),r.postMessage({workerId:e,result:n||!1})}}else n(t.result||null),delete r.action[t.clientID]}}))}async ZipCompress(e,s,r,n){nt.nil(t.zip)&&await at.addLib("zip.min.js"),nt.bool(r)&&(n=r,r=x);const a=t.zip;if(!0===n){const t=new a.BlobWriter,n=new a.ZipWriter(t);let i;const o=t=>(i||(i=t.name),n.add(t.name,new a.BlobReader(t),{onprogress:(e,r)=>s&&s(e,r,t.name,"pack"),password:r}));return nt.buf(e)&&(e=nt.File([e],"unknow.data",at.getMime())),nt.blob(e)?await o(e):nt.ForOf(e,(async t=>{nt.array(t)?t=nt.File([t[1]],t[0],at.getMime(t[0])):nt.buf(t)&&(t=nt.File([t],"unknow.data",at.getMime())),await o(t)})),await n.close(),nt.File([await t.getData()],i+".zip",at.getMime("zip"))}{const t="Enter password.",n=await new a.ZipReader(new a.BlobReader(nt.blob(e)?e:nt.toBlob(e))).getEntries().catch((t=>null));let i;const o=e=>{let n;return e.encrypted&&r&&(n=nt.buf(r)?r:0==e.filenameUTF8?this.str2gb2312(r):nt.encode(r)),e.getData(new a.Uint8ArrayWriter,{rawPassword:n,onprogress:(t,r,n)=>s&&s(t,r,e.filename,"unpack",n)}).catch((async s=>{let n=s.message;if(!1!==r&&(n==a.ERR_INVALID_PASSWORD||n==a.ERR_ENCRYPTED)){if(nt.buf(r)&&(r=nt.decode(r,"gbk")),r=k(t,r))return await o(e);r=!1}}))};if(n)for await(let t of n){if(t.directory)continue;let e=await o(t);e&&(i||(i={}),i[t.filename]=e)}return i}}async Decompress(t,e,s){let r=t.slice(0,6);if(nt.blob(r)&&(r=await nt.toU8(r)),r=nt.toUp(nt.buf2str(r)),/^504B0304/.test(r))return at.ZipCompress(t,e,s);let n=/^52617221/.test(r)?"rar":/^377ABCAF271C/.test(r)?"7z":x;if(!n)return null;t=await nt.toU8(t);const a=await at.FetchLibUrl(/7z$/.test(n)?"extract7z.zip":"libunrar.min.zip",e);return a?nt.Async((r=>{let n,i=new W(a);i.on("message",(t=>{if(nt.obj(t.data)){const{t:a,data:o,file:l,total:c,current:u,name:h}=t.data;if(1==a)r(n);else{if(2==a)return!n&&(n={}),o&&(n[l]=o);if(4==a)return c>0&&c>=u&&nt.tryC(e,e,u,c,h||l);if(-1===a){if(s=k(this.pwText,s||""))return i.postMessage({password:s});r(null)}}i.terminate()}})),i.on("error",(t=>{r(null),i.terminate()})),i.onmessageerror=t=>i.toEvent("error"),i.postMessage({contents:t,password:s})})):null}str2gb2312(t){const e=[[161,169,161,254],[176,247,161,254],[129,160,64,254],[170,254,64,160],[168,169,64,160],[170,175,161,254],[248,254,161,254],[161,167,64,160]];let s=new Uint16Array(23940),r=0;for(const[t,n,a,i]of e)for(let e=a;e<=i;e++)if(127!==e)for(let a=t;a<=n;a++)s[r++]=e<<8|a;let n=new Uint16Array(65536),a=new m("gbk").decode(s);for(let t=0;t<a.length;t++)n[a.charCodeAt(t)]=s[t];a=null,s=null;let i=[];for(let e=0;e<t.length;e++){const s=t.charCodeAt(e);if(s<128){i.push(s);continue}const r=n.at(s);r&&65535!==r?(i.push(r),i.push(r>>8)):8364===s?i.push(128):i.push(63)}return n=null,new l(i)}addJS(t,e,s){return nt.Async((r=>{s||!1===s||(s=nt.str(t)&&/\.css$/.test(t)||nt.file(t)&&/css$/.test(t.name)||!1);const n=this.URL(t);nt.fn(e)||(e=!1);const a=(s?g.head:g.body).appendChild(g.createElement(s?"link":"script")),i={type:this.getMime(s?"css":"js"),href:n,src:n,rel:z.name,crossorigin:"anonymous",load(t){this.un("error",i.error),r(e&&e(t)||t)},error(t){this.un("load",i.error),r(e&&e(t)||t)}};nt.setElm(a,i)}))}URL(t,e){return nt.str(t)&&t.length<255&&/^(blob|http|\/{1,2}(?!\*)|\.\/|.+\/)[^\n]*?$/i.test(t)?t:(e||(e=nt.blob(t)?t.type:"js"),p.createObjectURL(nt.blob(t)?t:new a([t],{type:this.getMime(e)})))}reURL(t){return p.revokeObjectURL(t)}customElement(t,e){if(!S.get(t)){const r=class extends w{constructor(){super();const t=this.dataset.callinit;this.tag_name=this.tagName.toLowerCase(),this.goFunc(t||"Init")}goFunc(t,...e){if(this[t])return this[t](...e);const s=this.tag_name.replace(/\-(\w)/,(t=>t[1].toUpperCase()));P.log(s+t),nt.tryA(this,at.action[s+t],e)}connectedCallback(...t){const e=this.dataset.callback;this.goFunc(e||"Connected",...t)}attributeChangedCallback(...t){const e=this.dataset.callattr;this.goFunc(e||"AttrChange",...t)}disconnectedCallback(...t){const e=this.dataset.callremove;this.goFunc(e||"Disconnected",...t)}};e&&s.assign(r.prototype,e),S.define(t,r)}}Err(t){return new Error(t)}async download(t,e,s){let r;return!e&&t&&(e=t,t=null),/^(http|blob:|data:)/.test(e)?(r=e,!t&&/^(http|blob:)/.test(e)&&(t=this.getName(e))):e&&(nt.file(e)&&(t=e.name),r=this.URL(e,s)),t||(t="explame.html"),nt.Async((e=>{const s=g.createElement("a");s.href=r,s.download=t,s.click(),s.remove(),e(!0)}))}toSet(t){(t=t||new class extends ${}).action=t.action||{};const{RF:e,CF:r,BF:n}=this;return s.assign(t,{RF:e,CF:r,BF:n}),t}$(t,e){return t?nt.str(t)?(e||g).querySelector(t):nt.fn(t)?at.docload(t):t:x}$$(t,e){return(e||g).querySelectorAll(t)||[]}docElm(t,e){return(new j).parseFromString(t,e||g.contentType).documentElement}RF(t,e){return nt.tryA(this,this.action[t],e,!0)}CF(t,...e){return this.RF(t,e)}BF(t,e,...s){const r=this.action[t];return nt.fn(r)?nt.tryA(e,r,s):x}async toZip(t,e,s){return at.ZipCompress(t,e,s,!0)}upload(t,e,s){const r=g.createElement("input");nt.setElm(r,{type:i.name,accept:e,multiple:s,change(){this.remove(),nt.tryC(this,t,nt.toArr(this.files))},cancel(){this.remove()}}).click()}async postMessage(t,e){if(!e){e=(await navigator.serviceWorker.ready).active}nt.await(e)&&(e=await e),e&&e.postMessage(t)}getRandStr(){return btoa(nt.tryC(crypto,"randomUUID")||performance.now()+Math.random()).replace(/[^\w]/g,"")}toReplace(t,e){return nt.str(e)?t=nt.R(t,/{value}/,e):nt.obj(e)&&nt.toArr(e,(e=>t=nt.R(t,new b(e[0],"g"),e[1]))),t}getLang(t,e){return nt.none(at.language[t])||(t=at.language[t]),e?at.toReplace(t,e):t}getMessage(t,e,s){let r=this;return nt.Async((n=>{let a=r.getRandStr();r.action[a]=nt.fn(s)?s(a,n):function(t){n(t.result),r.action[a]=null,delete r.action[a],delete t.result,t=null},r.postMessage({clientID:a,method:t,result:e})}))}async getTemplate(t,e){let s=await this.getTable("libjs").ajax({url:"/template-"+t+".html",type:"text"});return nt.toArr(e,(t=>{s=s.replace(new b(t[0],"g"),t[1])})),s=s.replace(/\{[\w\-\_]+?\}/,""),s}getPath(t){return t&&nt.toStr(t.split("/").slice(0,-1),"/")+"/"}getName(t){return nt.str(t)?t.split("/").pop().split(/\?/)[0].split(/\#/)[0]:""}dirname(t,e){return e||(e=1),nt.toStr(this.getPath(t).split("/").slice(0,-1-e),"/")+"/"}getExt(t){return nt.toLow(this.getName(t).split(".").pop())}getKey(t){return nt.R(this.getName(t),/\.\w+$/)}exttype={};setMime(){this.extlist=nt.toObj([].concat(..."text;css,scss,sass,xml,vml,style:css,htm:html|php,txt:plain,m3u8:plain,js:javascript\nimage;jpg,jpeg,png,gif,webp,avif,apng,heic,svg:svg+xml\nfont;woff,woff2,ttf,otf\napplication;pdf,json,js:javascript,*:octet-stream,zip:zip|x-zip-compressed,rar:rar|x-rar-compressed,7z:7z|x-7z-compressed,wasm\naudio;ogg,wma,mp3,m4a:mp4\nvideo;mp4".split(/\n/).map((t=>(t=t.split(/;/),[].concat(...t[1].split(/,/).map((e=>{let s=(e=e.split(/:/))[1]&&e[1].split("|")||[e[0]],r=[];for(let n=0;s[n];n++){let a=t[0]+"/"+s[n];this.exttype[a]=e[0],r.push([e[0],a])}return r}))))))))}getMime(t){return this.extlist||this.setMime(),t=t&&nt.toLow(t)||"",this.exttype[t]||/^\w+\/[\w\;]+$/.test(t)?t:(/^\w+$/.test(t)||(t=this.getExt(t)||t.split(".").pop()),this.extlist[t]||this.extlist["*"])}Mime(t){let e=this;if(e.extlist||e.setMime(),e.exttype[t])return e.exttype[t];if(t=t&&t.split("/").pop().split(";")[0].split("+")[0].trim())if(!1!==t.indexOf("x-")){if((t=t.match(/x\-(\w+)/))[1])return t[1]}else if(/^\w+$/.test(t))return t;return""}action={};docload(t){if("complete"==g.readyState)nt.tryC(this,t);else{const e=s=>{"complete"==g.readyState&&(nt.tryC(this,t),g.un("readystatechange",e))};g.on("readystatechange",e)}}constructor(){super();const t=this;let{language:e,onLine:r}=navigator,{readyState:n,currentScript:a,characterSet:i}=g,o=a&&a.src.split(/\?/),l=o&&t.getPath(o[0]),c=nt.toLow(e).split("-");if("zh"==c[0]&&("cn"==c[1]?c[1]="hans":"hk"!=c[1]&&(c[1]="hant")),s.assign(t,{I:nt,JSpath:l,libPath:l+"lib/",ROOT:t.dirname(l,2),i18nName:nt.toStr(c,"-"),langName:e,onLine:r,readyState:n,isTouch:nt.I(w,"ontouchstart"),css:new st}),a){let e=a.dataset;t.debug=e.debug,e.sw&&(t.SW=new rt(t,"/sw.js"),t.once("pwaload",(function(){let e=t.$("#footer");if(e){let t=e.appendChild(g.createElement("button"));t.innerHTML="刷新PWA",t.once("click",(async function(){this.remove(),(await navigator.serviceWorker.ready).active.update(),T.reload()}))}}))),t.docload((async s=>{const r=t.getTable("libjs"),n=t.dirname(t.JSpath),{router:a,fonts:i,version:o}=e;t.hashVersion=o?R(o):t.version,i&&nt.toArr(new Set(i.split(",")),(e=>r.fetch({url:n+e.split(":")[1],key:!0}).then((s=>t.css.addFont(s,e.split(":")[0]))))),a&&await nt.Async(nt.toArr(new Set(a.split(",")),(e=>e&&t.addJS(t.JSpath+"router/"+e+".js?"+t.hashVersion,!0,!1)&&P.log(e+".js")))),t.toEvent("ready")}))}}};window.onerror=t=>E(t),s.assign(t,{T:at,I:nt}),nt.defines(t,{Nenge:at},1)}));